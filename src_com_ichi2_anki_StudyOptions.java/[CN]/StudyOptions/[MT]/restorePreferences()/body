{
  SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
  mPrefDeckPath=preferences.getString("deckPath",AnkiDroidApp.getStorageDirectory());
  mPrefStudyOptions=preferences.getBoolean("study_options",true);
  mStartupMode=Integer.parseInt(preferences.getString("startup_mode",Integer.toString(SUM_DECKPICKER_ON_FIRST_START)));
  mSwipeEnabled=preferences.getBoolean("swipe",false);
  mLastTimeOpened=preferences.getLong("lastTimeOpened",0);
  BroadcastMessage.init(this,mLastTimeOpened);
  preferences.edit().putLong("lastTimeOpened",System.currentTimeMillis()).commit();
  if (!preferences.getString("lastVersion","").equals(getVersion())) {
    mNewVersionAlert=Themes.htmlOkDialog(this,getResources().getString(R.string.new_version_title) + " " + getVersion(),getVersionMessage(),new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        PrefSettings.getSharedPrefs(StudyOptions.this.getBaseContext()).edit().putString("lastVersion",getVersion()).commit();
        BroadcastMessage.checkForNewMessage(StudyOptions.this);
      }
    }
,new DialogInterface.OnCancelListener(){
      @Override public void onCancel(      DialogInterface dialog){
        BroadcastMessage.checkForNewMessage(StudyOptions.this);
      }
    }
,true);
    AnkiDroidApp.createNoMediaFileIfMissing(new File(mPrefDeckPath));
  }
 else {
    if (!preferences.getBoolean("firstStart",true)) {
      BroadcastMessage.checkForNewMessage(this);
    }
  }
  final float gestureScale=getResources().getDisplayMetrics().density;
  int sensibility=preferences.getInt("swipeSensibility",100);
  if (sensibility != 100) {
    float sens=(200 - sensibility) / 100.0f;
    sSwipeMinDistance=(int)(SWIPE_MIN_DISTANCE_DIP * sens * gestureScale + 0.5f);
    sSwipeThresholdVelocity=(int)(SWIPE_THRESHOLD_VELOCITY_DIP * sens * gestureScale + 0.5f);
    sSwipeMaxOffPath=(int)(SWIPE_MAX_OFF_PATH_DIP * Math.sqrt(sens) * gestureScale + 0.5f);
  }
 else {
    sSwipeMinDistance=(int)(SWIPE_MIN_DISTANCE_DIP * gestureScale + 0.5f);
    sSwipeThresholdVelocity=(int)(SWIPE_THRESHOLD_VELOCITY_DIP * gestureScale + 0.5f);
    sSwipeMaxOffPath=(int)(SWIPE_MAX_OFF_PATH_DIP * gestureScale + 0.5f);
  }
  mInvertedColors=preferences.getBoolean("invertedColors",false);
  mSwap=preferences.getBoolean("swapqa",false);
  mLocale=preferences.getString("language","");
  mZeemoteEnabled=preferences.getBoolean("zeemote",false);
  setLanguage(mLocale);
  return preferences;
}
