{
  Log.i(AnkiDroidApp.TAG,"DeckPicker - onCreate");
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  setTitleText();
  mSelf=this;
  setContentView(R.layout.deck_picker);
  registerExternalStorageListener();
  initDialogs();
  Themes.setContentStyle((View)findViewById(R.id.deckpicker_view),Themes.CALLER_DECKPICKER);
  mDeckpickerButtons=(View)findViewById(R.id.deckpicker_buttons);
  mSyncAllButton=(Button)findViewById(R.id.sync_all_button);
  mSyncAllButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      if (AnkiDroidApp.isUserLoggedIn()) {
        mSyncAllButton.setClickable(false);
        SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
        String username=preferences.getString("username","");
        String password=preferences.getString("password","");
        Connection.syncAllDecks(mSyncAllDecksListener,new Connection.Payload(new Object[]{username,password,mDeckList}));
      }
 else {
        showDialog(DIALOG_USER_NOT_LOGGED_IN);
      }
    }
  }
);
  mStatisticsAllButton=(Button)findViewById(R.id.statistics_all_button);
  mStatisticsAllButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      mStatisticType=-1;
      showDialog(DIALOG_SELECT_STATISTICS_TYPE);
    }
  }
);
  mDeckList=new ArrayList<HashMap<String,String>>();
  mDeckListView=(ListView)findViewById(R.id.files);
  mDeckListAdapter=new AlternatingAdapter(this,mDeckList,R.layout.deck_item,new String[]{"name","due","new","showProgress","notes","rateOfCompletionMat","rateOfCompletionAll"},new int[]{R.id.DeckPickerName,R.id.DeckPickerDue,R.id.DeckPickerNew,R.id.DeckPickerProgress,R.id.DeckPickerUpgradeNotesButton,R.id.DeckPickerCompletionMat,R.id.DeckPickerCompletionAll});
  mDeckListAdapter.setViewBinder(new SimpleAdapter.ViewBinder(){
    @Override public boolean setViewValue(    View view,    Object data,    String text){
      if (view instanceof ProgressBar) {
        if (text.equals("true")) {
          view.setVisibility(View.VISIBLE);
        }
 else {
          view.setVisibility(View.GONE);
        }
        return true;
      }
      if (view.getId() == R.id.DeckPickerCompletionMat || view.getId() == R.id.DeckPickerCompletionAll) {
        if (!text.equals("-1")) {
          Utils.updateProgressBars(DeckPicker.this,view,Double.parseDouble(text) / 100.0,mDeckListView.getWidth(),2,false);
        }
 else {
          Themes.setContentStyle(view,Themes.CALLER_DECKPICKER_DECK);
        }
      }
      if (view.getId() == R.id.DeckPickerUpgradeNotesButton) {
        if (text.equals("")) {
          view.setVisibility(View.GONE);
        }
 else {
          view.setVisibility(View.VISIBLE);
          view.setTag(text);
          view.setOnClickListener(new OnClickListener(){
            @Override public void onClick(            View v){
              String tag=(String)v.getTag();
              if (tag == null) {
                tag="";
              }
              mUpgradeNotesAlert.setMessage(tag);
              mUpgradeNotesAlert.show();
            }
          }
);
        }
        return true;
      }
      return false;
    }
  }
);
  mDeckListView.setOnItemClickListener(mDeckSelHandler);
  mDeckListView.setAdapter(mDeckListAdapter);
  registerForContextMenu(mDeckListView);
  SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
  mPrefDeckPath=preferences.getString("deckPath",AnkiDroidApp.getStorageDirectory());
  mPrefDeckOrder=Integer.parseInt(preferences.getString("deckOrder","0"));
  mPrefStartupDeckPicker=Integer.parseInt(preferences.getString("startup_mode","2")) == StudyOptions.SUM_DECKPICKER;
  populateDeckList(mPrefDeckPath);
  mSwipeEnabled=preferences.getBoolean("swipe",false);
  gestureDetector=new GestureDetector(new MyGestureDetector());
  mDeckListView.setOnTouchListener(new View.OnTouchListener(){
    public boolean onTouch(    View v,    MotionEvent event){
      if (gestureDetector.onTouchEvent(event)) {
        return true;
      }
      return false;
    }
  }
);
}
