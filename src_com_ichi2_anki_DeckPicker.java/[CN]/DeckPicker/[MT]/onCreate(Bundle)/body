{
  Log.i(AnkiDroidApp.TAG,"DeckPicker - onCreate");
  super.onCreate(savedInstanceState);
  mSelf=this;
  setContentView(R.layout.deck_picker);
  registerExternalStorageListener();
  initDialogs();
  mSyncAllBar=(RelativeLayout)findViewById(R.id.sync_all_bar);
  mSyncAllButton=(Button)findViewById(R.id.sync_all_button);
  mSyncAllButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View v){
      if (AnkiDroidApp.isUserLoggedIn()) {
        SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
        String username=preferences.getString("username","");
        String password=preferences.getString("password","");
        Connection.syncAllDecks(mSyncAllDecksListener,new Connection.Payload(new Object[]{username,password,mDeckList}));
      }
 else {
        showDialog(DIALOG_USER_NOT_LOGGED_IN);
      }
    }
  }
);
  mDeckList=new ArrayList<HashMap<String,String>>();
  mDeckListView=(ListView)findViewById(R.id.files);
  mDeckListAdapter=new SimpleAdapter(this,mDeckList,R.layout.deck_item,new String[]{"name","due","new","showProgress","notes"},new int[]{R.id.DeckPickerName,R.id.DeckPickerDue,R.id.DeckPickerNew,R.id.DeckPickerProgress,R.id.DeckPickerUpgradeNotesButton});
  mDeckListAdapter.setViewBinder(new SimpleAdapter.ViewBinder(){
    @Override public boolean setViewValue(    View view,    Object data,    String text){
      if (view instanceof ProgressBar) {
        if (text.equals("true")) {
          view.setVisibility(View.VISIBLE);
        }
 else {
          view.setVisibility(View.GONE);
        }
        return true;
      }
      if (view.getId() == R.id.DeckPickerUpgradeNotesButton) {
        if (text.equals("")) {
          view.setVisibility(View.GONE);
        }
 else {
          view.setVisibility(View.VISIBLE);
          view.setTag(text);
          view.setOnClickListener(new OnClickListener(){
            @Override public void onClick(            View v){
              String tag=(String)v.getTag();
              if (tag == null) {
                tag="";
              }
              mUpgradeNotesAlert.setMessage(tag);
              mUpgradeNotesAlert.show();
            }
          }
);
        }
        return true;
      }
      return false;
    }
  }
);
  mDeckListView.setOnItemClickListener(mDeckSelHandler);
  mDeckListView.setAdapter(mDeckListAdapter);
  registerForContextMenu(mDeckListView);
  SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
  populateDeckList(preferences.getString("deckPath",AnkiDroidApp.getStorageDirectory()));
}
