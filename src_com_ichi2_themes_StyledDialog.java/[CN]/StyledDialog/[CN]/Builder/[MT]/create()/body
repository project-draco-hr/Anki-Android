{
  final StyledDialog dialog=new StyledDialog(context);
  LayoutInflater inflater=(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
  View layout=inflater.inflate(R.layout.styled_dialog,null);
  dialog.addContentView(layout,new LayoutParams(LayoutParams.FILL_PARENT,LayoutParams.WRAP_CONTENT));
  if (title != null && title.length() > 0) {
    ((TextView)layout.findViewById(R.id.alertTitle)).setText(title);
    if (icon != 0) {
      ((ImageView)layout.findViewById(R.id.icon)).setImageResource(icon);
    }
 else {
      layout.findViewById(R.id.icon).setVisibility(View.GONE);
    }
  }
 else {
    layout.findViewById(R.id.topPanel).setVisibility(View.GONE);
    layout.findViewById(R.id.titleDivider).setVisibility(View.GONE);
  }
  int numberOfButtons=0;
  if (positiveButtonText != null) {
    Button button1=(Button)layout.findViewById(R.id.button1);
    button1.setText(positiveButtonText);
    button1.setOnClickListener(new OnClickForwarder(dialog,DialogInterface.BUTTON_POSITIVE,positiveButtonClickListener));
    numberOfButtons++;
  }
 else {
    layout.findViewById(R.id.button1).setVisibility(View.GONE);
  }
  if (negativeButtonText != null) {
    Button button2=(Button)layout.findViewById(R.id.button2);
    button2.setText(negativeButtonText);
    button2.setOnClickListener(new OnClickForwarder(dialog,DialogInterface.BUTTON_NEGATIVE,negativeButtonClickListener));
    numberOfButtons++;
  }
 else {
    layout.findViewById(R.id.button2).setVisibility(View.GONE);
  }
  if (neutralButtonText != null) {
    Button button3=(Button)layout.findViewById(R.id.button3);
    button3.setText(neutralButtonText);
    button3.setOnClickListener(new OnClickForwarder(dialog,DialogInterface.BUTTON_NEUTRAL,neutralButtonClickListener));
    numberOfButtons++;
  }
 else {
    layout.findViewById(R.id.button3).setVisibility(View.GONE);
  }
  if (numberOfButtons == 0) {
    layout.findViewById(R.id.buttonPanel).setVisibility(View.GONE);
  }
 else {
    layout.findViewById(R.id.bottomDivider).setVisibility(View.VISIBLE);
  }
  dialog.setCancelable(cancelable);
  dialog.setOnCancelListener(cancelListener);
  dialog.setOnDismissListener(dismissListener);
  if (message != null) {
    TextView tv=(TextView)layout.findViewById(R.id.message);
    tv.setText(message);
    if (messageSize != 0) {
      tv.setTextSize(messageSize * context.getResources().getDisplayMetrics().scaledDensity);
    }
  }
 else {
    ((LinearLayout)layout.findViewById(R.id.contentPanel)).setVisibility(View.GONE);
  }
  if (itemTitels != null) {
    dialog.setItems(listStyle,(ListView)layout.findViewById(R.id.listview),itemTitels,checkedItem,multipleCheckedItems,itemClickListener);
  }
 else {
    ((View)layout.findViewById(R.id.listViewPanel)).setVisibility(View.GONE);
  }
  if (contentView != null) {
    FrameLayout frame=(FrameLayout)layout.findViewById(R.id.custom);
    float factor=context.getResources().getDisplayMetrics().density;
    frame.setPadding((int)(2 * factor),(int)((5 - bottomMargin) * factor),(int)(2 * factor),(int)(bottomMargin * factor));
    frame.removeAllViews();
    frame.addView(contentView);
    layout.findViewById(R.id.bottomDivider).setVisibility(View.VISIBLE);
  }
 else {
    ((View)layout.findViewById(R.id.customPanel)).setVisibility(View.GONE);
  }
  try {
    Themes.setStyledDialogBackgrounds(layout,numberOfButtons,brightViewBackground);
  }
 catch (  OutOfMemoryError e) {
    Log.e(AnkiDroidApp.TAG,"StyledDialog - Dialog could not be created: " + e);
    Themes.showThemedToast(context,context.getResources().getString(R.string.error_insufficient_memory),false);
    return null;
  }
  dialog.setContentView(layout);
  return dialog;
}
