{
  Log.i(AnkiDroidApp.TAG,"BigWidget: buildUpdate (" + sCurrentView + ")");
  Resources res=getResources();
  RemoteViews updateViews=new RemoteViews(context.getPackageName(),R.layout.widget_big);
  if (sCurrentView == VIEW_SHOW_HELP) {
  }
 else   if (sLoadedDeck == null) {
    sCurrentView=VIEW_DECKS;
  }
 else   if (sCard == null) {
    sCurrentView=VIEW_NOTHING_DUE;
  }
  PendingIntent doNothingIntent=getDoNothingPendingIntent(context);
  if (mCurrentMessage != null) {
    updateViews.setTextViewText(R.id.widget_big_message,mCurrentMessage);
  }
 else {
    updateViews.setTextViewText(R.id.widget_big_message,"");
  }
  if (mShowProgressDialog) {
    updateViews.setViewVisibility(R.id.widget_big_progressbar,View.VISIBLE);
    updateViews.setViewVisibility(R.id.widget_big_empty,View.VISIBLE);
    updateViews.setViewVisibility(R.id.widget_big_flipcard,View.INVISIBLE);
    updateViews.setViewVisibility(R.id.widget_big_help,View.INVISIBLE);
    updateViews.setOnClickPendingIntent(R.id.widget_big_openclose,doNothingIntent);
    updateViews.setOnClickPendingIntent(R.id.widget_big_empty,doNothingIntent);
    disableCardAreaListeners(updateViews,false,doNothingIntent);
  }
 else {
    updateViews.setViewVisibility(R.id.widget_big_progressbar,View.INVISIBLE);
  }
switch (sCurrentView) {
case VIEW_SHOW_HELP:
case VIEW_DECKS:
    updateViews.setTextViewText(R.id.widget_big_deckname,"");
  updateCounts(updateViews);
updateViews.setViewVisibility(R.id.widget_big_empty,View.VISIBLE);
updateViews.setOnClickPendingIntent(R.id.widget_big_empty,sCurrentView == VIEW_SHOW_HELP ? getUpdatePendingIntent(this,VIEW_DECKS) : getHelpPendingIntent(this));
updateViews.setViewVisibility(R.id.widget_big_flipcard,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_help,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_open,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_close,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_nothing_due,View.INVISIBLE);
if (!mShowProgressDialog) {
updateViews.setOnClickPendingIntent(R.id.widget_big_openclose,getShowDeckSelectionPendingIntent(context));
disableCardAreaListeners(updateViews,false,doNothingIntent);
}
updateViews.setViewVisibility(R.id.widget_big_cardbackgroundstar,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_deckfield,View.VISIBLE);
updateViews.setTextViewText(R.id.widget_big_cardcontent,"");
updateViews.setViewVisibility(R.id.widget_big_add,View.INVISIBLE);
break;
case VIEW_SHOW_QUESTION:
if (!mShowProgressDialog) {
updateViews.setViewVisibility(R.id.widget_big_empty,View.VISIBLE);
updateViews.setOnClickPendingIntent(R.id.widget_big_empty,getAnswerPendingIntent(context,0));
updateViews.setViewVisibility(R.id.widget_big_flipcard,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_help,View.INVISIBLE);
enableCardAreaListeners(updateViews,true);
updateViews.setOnClickPendingIntent(R.id.widget_big_openclose,getCloseDeckPendingIntent(context));
}
updateViews.setTextViewText(R.id.widget_big_cardcontent,Html.fromHtml(sCard.getQuestion()));
updateViews.setTextViewText(R.id.widget_big_message,getNextTimeString(sCard));
updateViews.setTextViewText(R.id.widget_big_deckname,sLoadedDeck.getDeckName());
updateCounts(updateViews);
updateViews.setViewVisibility(R.id.widget_big_open,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_close,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_nothing_due,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_deckfield,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_cardbackgroundstar,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_add,View.VISIBLE);
break;
case VIEW_SHOW_ANSWER:
if (!mShowProgressDialog) {
updateViews.setOnClickPendingIntent(R.id.widget_big_ease1,getAnswerPendingIntent(context,1));
updateViews.setOnClickPendingIntent(R.id.widget_big_ease2,getAnswerPendingIntent(context,2));
updateViews.setOnClickPendingIntent(R.id.widget_big_ease3,getAnswerPendingIntent(context,3));
updateViews.setOnClickPendingIntent(R.id.widget_big_ease4,getAnswerPendingIntent(context,4));
if (sCard.isRev()) {
updateViews.setViewVisibility(R.id.widget_big_ease2_normal,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease2_rec,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease3_normal,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease3_rec,View.VISIBLE);
}
 else {
updateViews.setViewVisibility(R.id.widget_big_ease2_normal,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease2_rec,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease3_normal,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_ease3_rec,View.INVISIBLE);
}
updateViews.setViewVisibility(R.id.widget_big_nothing_due,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_empty,View.INVISIBLE);
enableCardAreaListeners(updateViews,false);
}
 else {
updateViews.setOnClickPendingIntent(R.id.widget_big_ease1,doNothingIntent);
updateViews.setOnClickPendingIntent(R.id.widget_big_ease2,doNothingIntent);
updateViews.setOnClickPendingIntent(R.id.widget_big_ease3,doNothingIntent);
updateViews.setOnClickPendingIntent(R.id.widget_big_ease4,doNothingIntent);
}
updateViews.setTextViewText(R.id.widget_big_cardcontent,Html.fromHtml(sCard.getQuestion() + "<br>???????????????<br>" + sCard.getAnswer()));
break;
case VIEW_NOTHING_DUE:
updateViews.setTextViewText(R.id.widget_big_deckname,sLoadedDeck.getDeckName());
updateCounts(updateViews);
if (!mShowProgressDialog) {
updateViews.setViewVisibility(R.id.widget_big_empty,View.VISIBLE);
updateViews.setOnClickPendingIntent(R.id.widget_big_empty,doNothingIntent);
updateViews.setViewVisibility(R.id.widget_big_flipcard,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_help,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_open,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_close,View.INVISIBLE);
disableCardAreaListeners(updateViews,true,doNothingIntent);
updateViews.setOnClickPendingIntent(R.id.widget_big_openclose,getCloseDeckPendingIntent(context));
updateViews.setViewVisibility(R.id.widget_big_nothing_due,View.VISIBLE);
updateViews.setTextViewText(R.id.widget_big_cardcontent,"");
}
updateViews.setViewVisibility(R.id.widget_big_add,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_deckfield,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_cardbackgroundstar,View.VISIBLE);
updateViews.setTextViewText(R.id.widget_big_congrats,StudyOptions.getCongratsMessage(this,sLoadedDeck));
updateViews.setViewVisibility(R.id.widget_big_open,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_close,View.VISIBLE);
updateViews.setOnClickPendingIntent(R.id.widget_big_review_early,getReviewEarlyPendingIntent(context));
updateViews.setOnClickPendingIntent(R.id.widget_big_learn_more,getLearnMorePendingIntent(context));
break;
}
if (sCurrentView == VIEW_SHOW_HELP) {
String[] values=res.getStringArray(R.array.gestures_labels);
updateViews.setTextViewText(R.id.widget_big_topleft,res.getString(R.string.open_in_reviewer));
updateViews.setTextViewText(R.id.widget_big_middleleft,values[12]);
updateViews.setTextViewText(R.id.widget_big_bottomleft,values[1]);
updateViews.setTextViewText(R.id.widget_big_topright,values[9]);
updateViews.setTextViewText(R.id.widget_big_middleright,values[7]);
updateViews.setTextViewText(R.id.widget_big_bottomright,values[5]);
updateViews.setViewVisibility(R.id.widget_big_empty,View.VISIBLE);
updateViews.setViewVisibility(R.id.widget_big_deckfield,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_flipcard,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_help,View.VISIBLE);
updateViews.setTextViewText(R.id.widget_big_cardcontent,"");
updateViews.setViewVisibility(R.id.widget_big_cardbackgroundstar,View.INVISIBLE);
updateViews.setViewVisibility(R.id.widget_big_nothing_due,View.INVISIBLE);
if (!mShowProgressDialog) {
disableCardAreaListeners(updateViews,false,doNothingIntent);
}
}
 else {
updateViews.setTextViewText(R.id.widget_big_topleft,"");
updateViews.setTextViewText(R.id.widget_big_middleleft,"");
updateViews.setTextViewText(R.id.widget_big_bottomleft,"");
updateViews.setTextViewText(R.id.widget_big_topright,"");
updateViews.setTextViewText(R.id.widget_big_middleright,"");
updateViews.setTextViewText(R.id.widget_big_bottomright,"");
}
return updateViews;
}
