{
  String deckFilename="";
  ZipInputStream zipInputStream=null;
  if (sharedDeck.getFileName().endsWith(".zip")) {
    zipInputStream=new ZipInputStream(source);
    String title=sharedDeck.getTitle();
    title=title.replace("^","");
    title=title.substring(0,java.lang.Math.min(title.length(),40));
    if (new File(deckPath + "/" + title+ ".anki").exists())     title+=System.currentTimeMillis();
    String partialDeckPath=deckPath + "/" + title;
    deckFilename=partialDeckPath + ".anki";
    ZipEntry zipEntry=null;
    while ((zipEntry=zipInputStream.getNextEntry()) != null) {
      if ("shared.anki".equalsIgnoreCase(zipEntry.getName())) {
        Utils.writeToFile(zipInputStream,deckFilename + ".tmp");
      }
 else       if (zipEntry.getName().startsWith("shared.media/",0)) {
        Utils.writeToFile(zipInputStream,partialDeckPath + ".media/" + zipEntry.getName().replace("shared.media/",""));
      }
    }
    zipInputStream.close();
    new File(deckFilename + ".tmp").renameTo(new File(deckFilename));
  }
  return deckFilename;
}
