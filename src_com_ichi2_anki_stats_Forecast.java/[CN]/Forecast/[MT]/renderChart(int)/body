{
  calcStats(type);
  int height=mImageView.getMeasuredHeight();
  int width=mImageView.getMeasuredWidth();
  Log.d(AnkiStatsTaskHandler.TAG,"heigth: " + height + ", width: "+ width+ ", "+ mImageView.getWidth());
  if (height <= 0 || width <= 0) {
    return null;
  }
  BufferedImage bufferedFrameImage=new BufferedImage(width,height,BufferedImage.TYPE_INT_ARGB);
  Graphics2D g=bufferedFrameImage.createGraphics();
  Rectangle rect=new Rectangle(width,height);
  g.setClip(rect);
  g.setColor(Color.BLACK);
  float textSize=AnkiStatsTaskHandler.getInstance().getmStandardTextSize() * 0.75f;
  g.setFontSize(textSize);
  float FontHeigth=g.getFontMetrics().getHeight(true);
  mFrameThickness=Math.round(FontHeigth * 4.0f);
  int end=0;
switch (mType) {
case Stats.TYPE_MONTH:
    end=31;
  break;
case Stats.TYPE_YEAR:
end=52;
break;
default :
case Stats.TYPE_LIFE:
end=(int)mLastElement;
break;
}
PlotSheet plotSheet=new PlotSheet(-0.5,end + 0.5,0,mMaxCards * 1.1);
double xTics=ticsCalcX(150,rect,0,end);
double yTics=ticsCalcY(150,rect,0,mMaxCards);
plotSheet.setFrameThickness(mFrameThickness);
XAxis xaxis=new XAxis(plotSheet,0,xTics,xTics / 2.0);
YAxis yaxis=new YAxis(plotSheet,0,yTics,yTics / 2.0);
xaxis.setOnFrame();
xaxis.setName(mImageView.getResources().getStringArray(R.array.due_x_axis_title)[mAxisTitles[0]]);
xaxis.setIntegerNumbering(true);
yaxis.setIntegerNumbering(true);
yaxis.setName(mImageView.getResources().getString(mAxisTitles[1]));
yaxis.setOnFrame();
double[][] bars=new double[2][];
bars[0]=mSeriesList[0];
bars[1]=mSeriesList[1];
BarGraph barGraph=new BarGraph(plotSheet,barThickness,bars,new Color(mImageView.getResources().getColor(mColors[0])));
barGraph.setFilling(true);
barGraph.setName(mImageView.getResources().getString(mValueLabels[0]));
barGraph.setFillColor(new Color(mImageView.getResources().getColor(mColors[0])));
double[][] bars2=new double[2][];
bars2[0]=mSeriesList[0];
bars2[1]=mSeriesList[2];
BarGraph barGraphMature=new BarGraph(plotSheet,barThickness,bars2,new Color(mImageView.getResources().getColor(mColors[1])));
barGraphMature.setFilling(true);
barGraphMature.setFillColor(new Color(mImageView.getResources().getColor(mColors[1])));
barGraphMature.setName(mImageView.getResources().getString(mValueLabels[1]));
double[][] cumulative=mCumulative;
PlotSheet hiddenPlotSheet=new PlotSheet(-0.5,end + 0.5,0,cumulative[1][cumulative[1].length - 1] * 1.1);
Lines lines=new Lines(hiddenPlotSheet,cumulative,Color.black);
lines.setSize(3f);
lines.setName(mImageView.getResources().getString(R.string.stats_cumulative));
lines.setShadow(5f,3f,3f,Color.BLACK);
hiddenPlotSheet.setFrameThickness(mFrameThickness);
double rightYtics=ticsCalc(150,rect,cumulative[1][cumulative[1].length - 1] * 1.1);
YAxis rightYaxis=new YAxis(hiddenPlotSheet,0,rightYtics,rightYtics / 2.0);
rightYaxis.setIntegerNumbering(true);
rightYaxis.setName(mImageView.getResources().getString(mAxisTitles[2]));
rightYaxis.setOnRightSideFrame();
int red=Color.LIGHT_GRAY.getRed();
int green=Color.LIGHT_GRAY.getGreen();
int blue=Color.LIGHT_GRAY.getBlue();
Color newGridColor=new Color(red,green,blue,222);
XGrid xGrid=new XGrid(plotSheet,0,150);
YGrid yGrid=new YGrid(plotSheet,0,150);
xGrid.setColor(newGridColor);
yGrid.setColor(newGridColor);
plotSheet.setFontSize(textSize);
plotSheet.addDrawable(barGraph);
plotSheet.addDrawable(barGraphMature);
plotSheet.addDrawable(lines);
plotSheet.addDrawable(xaxis);
plotSheet.addDrawable(yaxis);
plotSheet.addDrawable(rightYaxis);
plotSheet.addDrawable(xGrid);
plotSheet.addDrawable(yGrid);
plotSheet.paint(g);
Bitmap bitmap=bufferedFrameImage.getBitmap();
bitmap.prepareToDraw();
return bitmap;
}
