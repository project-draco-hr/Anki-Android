{
  Log.i(AnkiDroidApp.TAG,"genPayload");
  preSyncRefresh();
  JSONObject payload=new JSONObject();
  Keys[] keys=Keys.values();
  for (int i=0; i < keys.length; i++) {
    Log.i(AnkiDroidApp.TAG,"Key " + keys[i].name());
    String key=keys[i].name();
    JSONArray diff=diffSummary((JSONObject)summaries.get(0),(JSONObject)summaries.get(1),key);
    payload.put("added-" + key,getObjsFromKey((JSONArray)diff.get(0),key));
    payload.put("deleted-" + key,diff.get(1));
    payload.put("missing-" + key,diff.get(2));
    deleteObjsFromKey((JSONArray)diff.get(3),key);
  }
  if (mLocalTime > mRemoteTime) {
    payload.put("stats",bundleStats());
    payload.put("history",bundleHistory());
    payload.put("sources",bundleSources());
    payload.put("deck",bundleDeck());
  }
  Log.i(AnkiDroidApp.TAG,"Payload =");
  Utils.printJSONObject(payload,true);
  return payload;
}
