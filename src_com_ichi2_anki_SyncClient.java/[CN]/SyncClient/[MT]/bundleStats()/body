{
  Log.i(AnkiDroidApp.TAG,"bundleStats");
  JSONObject bundledStats=new JSONObject();
  Date lastDay=new Date(java.lang.Math.max(0,(long)(deck.lastSync - 60 * 60 * 24) * 1000));
  Log.i(AnkiDroidApp.TAG,"lastDay = " + lastDay.toString());
  ArrayList<Long> ids=AnkiDatabaseManager.getDatabase(deck.deckPath).queryColumn(Long.class,"SELECT id FROM stats WHERE type = 1 and day >= \"" + lastDay.toString() + "\"",0);
  try {
    Stats stat=new Stats(deck);
    bundledStats.put("global",bundleStat(Stats.globalStats(deck)));
    JSONArray dailyStats=new JSONArray();
    for (    Long id : ids) {
      stat.fromDB(id);
      dailyStats.put(bundleStat(stat));
    }
    bundledStats.put("daily",dailyStats);
  }
 catch (  SQLException e) {
    Log.i(AnkiDroidApp.TAG,"SQLException = " + e.getMessage());
  }
catch (  JSONException e) {
    Log.i(AnkiDroidApp.TAG,"JSONException = " + e.getMessage());
  }
  Log.i(AnkiDroidApp.TAG,"Stats =");
  Utils.printJSONObject(bundledStats,false);
  return bundledStats;
}
