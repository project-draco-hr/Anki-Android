{
  File deckFile=new File(deckPath);
  Collection col=AnkiDroidApp.getCol();
  if (col != null) {
    col.close();
  }
  AnkiDatabaseManager.closeDatabase(deckPath);
  String execString="sqlite3 " + deckPath + " .dump | sqlite3 "+ deckPath+ ".tmp";
  Log.i(AnkiDroidApp.TAG,"repairDeck - Execute: " + execString);
  try {
    String[] cmd={"/system/bin/sh","-c",execString};
    Process process=Runtime.getRuntime().exec(cmd);
    process.waitFor();
    if (!new File(deckPath + ".tmp").exists()) {
      Log.e(AnkiDroidApp.TAG,"repairDeck - dump to " + deckPath + ".tmp failed");
      return false;
    }
    if (!moveDatabaseToBrokenFolder(deckPath,false)) {
      Log.e(AnkiDroidApp.TAG,"repairDeck - could not move corrupt file to broken folder");
      return false;
    }
    Log.i(AnkiDroidApp.TAG,"repairDeck - moved corrupt file to broken folder");
    File repairedFile=new File(deckPath + ".tmp");
    return repairedFile.renameTo(deckFile);
  }
 catch (  IOException e) {
    Log.e("AnkiDroidApp.TAG","repairCollection - error: " + e.getMessage());
  }
catch (  InterruptedException e) {
    Log.e("AnkiDroidApp.TAG","repairCollection - error: " + e.getMessage());
  }
  return false;
}
