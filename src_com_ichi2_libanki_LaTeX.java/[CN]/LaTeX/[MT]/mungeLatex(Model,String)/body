{
  StringBuilder sb=new StringBuilder(latex);
  Matcher namedEntity=htmlNamedEntityPattern.matcher(sb);
  while (namedEntity.find()) {
    sb.replace(namedEntity.start(),namedEntity.end(),Html.fromHtml(namedEntity.group()).toString());
    namedEntity=htmlNamedEntityPattern.matcher(sb);
  }
  latex=sb.toString();
  latex=sBRPattern.matcher(latex).replaceAll("\n");
  try {
    latex=model.getConf().getString("latexPre") + "\n" + latex+ "\n"+ model.getConf().getString("latexPost");
  }
 catch (  JSONException e) {
    throw new RuntimeException(e);
  }
  return latex;
}
