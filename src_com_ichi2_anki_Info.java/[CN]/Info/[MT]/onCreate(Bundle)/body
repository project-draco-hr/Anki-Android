{
  Log.i(AnkiDroidApp.TAG,"Info - onCreate()");
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  Resources res=getResources();
  mType=getIntent().getIntExtra(TYPE_EXTRA,TYPE_ABOUT);
  setTitle(getTitleString());
  setContentView(R.layout.info);
  mWebView=(WebView)findViewById(R.id.info);
  mWebView.setBackgroundColor(res.getColor(Themes.getBackgroundColor()));
  Themes.setWallpaper((View)mWebView.getParent().getParent().getParent());
  Button continueButton=(Button)findViewById(R.id.info_continue);
  continueButton.setOnClickListener(new OnClickListener(){
    @Override public void onClick(    View arg0){
      if (mType == TYPE_ABOUT) {
        Info.this.startActivity(new Intent(Intent.ACTION_VIEW,Uri.parse("market://details?id=com.ichi2.anki")));
        return;
      }
      setResult(RESULT_OK);
switch (mType) {
case TYPE_WELCOME:
        AnkiDroidApp.getSharedPrefs(Info.this.getBaseContext()).edit().putLong("lastTimeOpened",System.currentTimeMillis()).commit();
      break;
case TYPE_NEW_VERSION:
    AnkiDroidApp.getSharedPrefs(Info.this.getBaseContext()).edit().putString("lastVersion",AnkiDroidApp.getPkgVersion()).commit();
  break;
case TYPE_UPGRADE_DECKS:
break;
}
finishWithAnimation();
}
}
);
StringBuilder sb=new StringBuilder();
switch (mType) {
case TYPE_ABOUT:
String[] content=res.getStringArray(R.array.about_content);
sb.append("<html><body text=\"#000000\" link=\"#E37068\" alink=\"#E37068\" vlink=\"#E37068\">");
sb.append(String.format(content[0],res.getString(R.string.app_name),res.getString(R.string.link_anki))).append("<br/><br/>");
sb.append(String.format(content[1],res.getString(R.string.link_issue_tracker),res.getString(R.string.link_wiki),res.getString(R.string.link_forum))).append("<br/><br/>");
sb.append(String.format(content[2],res.getString(R.string.link_wikipedia_open_source),res.getString(R.string.link_contribution),res.getString(R.string.link_contribution_contributors))).append(" ");
sb.append(String.format(content[3],res.getString(R.string.link_translation),res.getString(R.string.link_donation))).append("<br/><br/>");
sb.append(String.format(content[4],res.getString(R.string.licence_wiki),res.getString(R.string.link_source))).append("<br/><br/>");
sb.append("</body></html>");
mWebView.loadDataWithBaseURL("",sb.toString(),"text/html","utf-8",null);
((Button)findViewById(R.id.info_continue)).setText(res.getString(R.string.info_rate));
break;
case TYPE_WELCOME:
sb.append("<html><body text=\"#000000\" link=\"#E37068\" alink=\"#E37068\" vlink=\"#E37068\">");
sb.append("<big><b>");
sb.append(res.getString(R.string.studyoptions_welcome_title));
sb.append("</big></b><br><br>");
sb.append(res.getString(R.string.welcome_message).replace("\n","<br>"));
sb.append("</body></html>");
mWebView.loadDataWithBaseURL("",sb.toString(),"text/html","utf-8",null);
Button tutBut=(Button)findViewById(R.id.info_tutorial);
tutBut.setVisibility(View.VISIBLE);
tutBut.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
setResult(RESULT_OK);
Editor edit=AnkiDroidApp.getSharedPrefs(Info.this.getBaseContext()).edit();
edit.putLong("lastTimeOpened",System.currentTimeMillis());
edit.putBoolean("createTutorial",true);
edit.commit();
finishWithAnimation();
}
}
);
break;
case TYPE_NEW_VERSION:
sb.append(res.getString(R.string.new_version_message));
sb.append("<ul>");
String[] features=res.getStringArray(R.array.new_version_features);
for (int i=0; i < features.length; i++) {
sb.append("<li>");
sb.append(features[i]);
sb.append("</li>");
}
sb.append("</ul>");
sb.append("</body></html>");
mWebView.loadDataWithBaseURL("",sb.toString(),"text/html","utf-8",null);
AnkiDroidApp.getSharedPrefs(Info.this.getBaseContext()).edit().putBoolean("sslAcceptAll",false).commit();
break;
case TYPE_SHARED_DECKS:
mLoadingLayer=(RelativeLayout)findViewById(R.id.info_loading_layer);
mLoadingLayer.setVisibility(View.VISIBLE);
try {
mShareDecksTemplate=Utils.convertStreamToString(getAssets().open("shared_decks_template.html"));
}
 catch (IOException e) {
e.printStackTrace();
}
mWebView.setWebViewClient(new MobileAnkiWebview());
mWebView.loadUrl(res.getString(R.string.shared_decks_url));
mWebView.getSettings().setJavaScriptEnabled(true);
continueButton.setText(res.getString(R.string.download_button_return));
break;
case TYPE_UPGRADE_DECKS:
sb.append("<html><body>");
Button but=(Button)findViewById(R.id.info_tutorial);
but.setVisibility(View.VISIBLE);
Button syncButton=(Button)findViewById(R.id.info_sync);
syncButton.setVisibility(View.VISIBLE);
mUpgradeStage=getIntent().getIntExtra(TYPE_UPGRADE_STAGE,-1);
switch (mUpgradeStage) {
case UPGRADE_SCREEN_BASIC1:
sb.append("This is a major update to Ankidroid and the upgrade process will take at least 5-10 minutes.<br><br>Do you want to proceed now or later?<br><br><a href=\"http://code.google.com/p/ankidroid/wiki/Upgrading?wl=en\">More info</a>");
but.setText(res.getString(R.string.later));
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Themes.showThemedToast(Info.this,"Please start Ankidroid again when you have time to upgrade!",false);
setResult(RESULT_CANCELED);
finish();
}
}
);
syncButton.setText("More Options");
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_MORE_OPTIONS);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
continueButton.setText("Now");
continueButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC2);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
break;
case UPGRADE_SCREEN_BASIC2:
sb.append("The recommended upgrade method is to sync with a PC and upgrade with the desktop version of Anki.<br><br>Do you want to upgrade with a PC?");
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC1);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setText(res.getString(R.string.no));
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_WEB_UPGRADE);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
continueButton.setText(res.getString(R.string.yes));
continueButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_PC_UPGRADE);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
break;
case UPGRADE_SCREEN_MORE_OPTIONS:
sb.append("You can create a new empty collection by clicking below.<br><br>If you want to downgrade back to AnkiDroid 1 then please (read <a href=\"http://code.google.com/p/ankidroid/wiki/Upgrading?wl=en#Continuing_to_use_AnkiDroid_1.1.3\">these instructions</a>).");
but.setText(res.getString(R.string.upgrade_decks_button));
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC1);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setText("Create new collection");
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
StyledDialog.Builder builder=new StyledDialog.Builder(Info.this);
builder.setTitle("Create New Collection");
builder.setIcon(R.drawable.ic_dialog_alert);
builder.setMessage("Are you sure you want to do this? Your old data will not be imported.");
Resources res=getResources();
builder.setPositiveButton(res.getString(R.string.yes),new DialogInterface.OnClickListener(){
@Override public void onClick(DialogInterface dialog,int which){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_CONTINUE);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
builder.setNegativeButton(res.getString(R.string.no),null);
builder.show();
}
}
);
continueButton.setVisibility(View.GONE);
break;
case UPGRADE_SCREEN_WEB_UPGRADE:
sb.append("<b>This upgrade method is not recommended if you used media files, or have a big collection!</b><br><br>Your anki1 decks will be zipped and uploaded to AnkiWeb, and the converted collection will then be downloaded.<br><br>Please note that a stable internet connection is required, and that there is a 50MB file limit.<br><br>Users of Anki Desktop are strongly encouraged to use the PC based upgrade method.<br><br>Do you still want to proceed?");
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC2);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setVisibility(View.GONE);
continueButton.setText(res.getString(R.string.yes));
continueButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
if (getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE) {
setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);
}
 else if (getResources().getConfiguration().orientation == Configuration.ORIENTATION_PORTRAIT) {
setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
}
Connection.upgradeDecks(mUpgradeListener,new Connection.Payload(new Object[]{AnkiDroidApp.getCurrentAnkiDroidDirectory()}));
}
}
);
break;
case UPGRADE_SCREEN_PC_UPGRADE:
sb.append("If you currently have an up-to-date version of your AnkiDroid collection in the Anki desktop software, you can upgrade from there and then download your upgraded collection by syncing with AnkiWeb.<br><br>Alternatively, you can copy your AnkiDroid collection to your PC using USB, then upgrade the collection and copy back to AnkiDroid.");
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC2);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setText("USB");
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_MANUAL_UPGRADE);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
continueButton.setText("AnkiWeb");
continueButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_AUTO_UPGRADE);
setResult(RESULT_OK,result);
finishWithAnimation();
}
}
);
break;
case UPGRADE_SCREEN_MANUAL_UPGRADE:
sb.append("Please copy all of your *.anki files (and any *.media folders) from your AnkiDroid folder to your Anki Desktop folder, and then install and start Anki Desktop version 2.0.4 or greater to upgrade your collection.<br><br>When the upgrade is completed, please export your collection from Anki2 and copy the collection.apkg file to your AnkiDroid folder and press the Import button below.<br><br><a href=\"http://code.google.com/p/ankidroid/wiki/Upgrading?wl=en#Option_1:_Using_USB_(recommended)\">More detailed information on upgrading using USB.</a>");
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_BASIC2);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setText("Import");
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_IMPORT);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
continueButton.setVisibility(View.GONE);
break;
case UPGRADE_SCREEN_AUTO_UPGRADE:
sb.append("Please install and start Anki Desktop version 2.0.4 or greater to upgrade your collection, then sync your upgraded collection with AnkiWeb and press the \"Download\" button.<br><br><a href=\"http://code.google.com/p/ankidroid/wiki/Upgrading?wl=en#Option_2:_Using_AnkiWeb_sync\">More detailed information on upgrading using AnkiWeb</a>");
but.setText("Back");
but.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
Intent result=new Intent();
result.putExtra(TYPE_UPGRADE_STAGE,UPGRADE_SCREEN_PC_UPGRADE);
result.putExtra(TYPE_ANINAMTION_RIGHT,true);
setResult(RESULT_OK,result);
finishWithAnimation(false);
}
}
);
syncButton.setText("Download");
syncButton.setOnClickListener(new OnClickListener(){
@Override public void onClick(View arg0){
downloadCollection();
}
}
);
continueButton.setVisibility(View.GONE);
break;
}
sb.append("</body></html>");
mWebView.loadDataWithBaseURL("",sb.toString(),"text/html","utf-8",null);
StyledDialog.Builder builder2=new StyledDialog.Builder(this);
builder2.setTitle(res.getString(R.string.connection_error_title));
builder2.setIcon(R.drawable.ic_dialog_alert);
builder2.setMessage(res.getString(R.string.connection_needed));
builder2.setPositiveButton(res.getString(R.string.ok),null);
mNoConnectionAlert=builder2.create();
break;
default :
finish();
break;
}
}
