{
  File deckFile=new File(deckPath);
  Collection col=AnkiDroidApp.getCol();
  if (col != null) {
    col.close();
  }
  AnkiDatabaseManager.closeDatabase(deckPath);
  String execString="sqlite3 " + deckPath + " .dump | sqlite3 "+ deckPath+ ".tmp";
  try {
    String[] cmd={"/system/bin/sh","-c",execString};
    Process process=Runtime.getRuntime().exec(cmd);
    process.waitFor();
    if (!new File(deckPath + ".tmp").exists()) {
      return false;
    }
    if (!moveDatabaseToBrokenFolder(deckPath,false)) {
      return false;
    }
    File repairedFile=new File(deckPath + ".tmp");
    if (!repairedFile.renameTo(deckFile)) {
      return false;
    }
    return true;
  }
 catch (  IOException e) {
    Log.e("AnkiDroidApp.TAG","repairCollection - error: " + e);
  }
catch (  InterruptedException e) {
    Log.e("AnkiDroidApp.TAG","repairCollection - error: " + e);
  }
  return false;
}
