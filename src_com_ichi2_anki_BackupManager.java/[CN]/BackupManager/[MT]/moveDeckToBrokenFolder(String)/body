{
  File deckFile=new File(deckPath);
  AnkiDatabaseManager.closeDatabase(deckPath);
  Date value=Utils.genToday(Utils.utcOffset());
  String movedFilename=String.format(Utils.ENGLISH_LOCALE,deckFile.getName().replace(".anki","") + "-corrupt-%tF.anki",value);
  File movedFile=new File(getBrokenDirectory().getPath(),movedFilename);
  int i=1;
  while (movedFile.exists()) {
    movedFile=new File(getBrokenDirectory().getPath(),movedFilename.replace(".anki","-" + Integer.toString(i) + ".anki"));
    i++;
  }
  movedFilename=movedFile.getName();
  if (!deckFile.renameTo(movedFile)) {
    return false;
  }
  String deckName=deckFile.getName();
  File directory=new File(deckFile.getParent());
  for (  File f : directory.listFiles()) {
    if (f.getName().startsWith(deckName)) {
      if (!f.renameTo(new File(getBrokenDirectory().getPath(),f.getName().replace(deckName,movedFilename)))) {
        return false;
      }
    }
  }
  return true;
}
