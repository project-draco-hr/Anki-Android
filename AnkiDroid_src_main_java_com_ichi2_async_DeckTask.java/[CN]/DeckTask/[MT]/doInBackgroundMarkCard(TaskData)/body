{
  Card card=params[0].getCard();
  Collection col=CollectionHelper.getInstance().getCol(mContext);
  try {
    AnkiDb ankiDB=col.getDb();
    ankiDB.getDatabase().beginTransaction();
    try {
      if (card != null) {
        Note note=card.note();
        if (note.hasTag("marked")) {
          note.delTag("marked");
        }
 else {
          note.addTag("marked");
        }
        note.flush();
      }
      publishProgress(new TaskData(card));
      ankiDB.getDatabase().setTransactionSuccessful();
    }
  finally {
      ankiDB.getDatabase().endTransaction();
    }
  }
 catch (  RuntimeException e) {
    Timber.e(e,"doInBackgroundMarkCard - RuntimeException on marking card");
    AnkiDroidApp.sendExceptionReport(e,"doInBackgroundMarkCard");
    return new TaskData(false);
  }
  return new TaskData(true);
}
