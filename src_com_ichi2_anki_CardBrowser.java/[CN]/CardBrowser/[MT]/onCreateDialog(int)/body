{
  StyledDialog dialog=null;
  Resources res=getResources();
  StyledDialog.Builder builder=new StyledDialog.Builder(this);
switch (id) {
case DIALOG_ORDER:
    builder.setTitle(res.getString(R.string.card_browser_change_display_order_title));
  builder.setMessage(res.getString(R.string.card_browser_change_display_order_reverse));
builder.setIcon(android.R.drawable.ic_menu_sort_by_size);
builder.setSingleChoiceItems(res.getStringArray(R.array.card_browser_order_labels),mOrder,new DialogInterface.OnClickListener(){
@Override public void onClick(DialogInterface arg0,int which){
  if (which != mOrder) {
    mOrder=which;
    mOrderAsc=false;
    try {
      if (mOrder == 0) {
        mCol.getConf().put("sortType",fSortTypes[1]);
        AnkiDroidApp.getSharedPrefs(getBaseContext()).edit().putBoolean("cardBrowserNoSorting",true).commit();
      }
 else {
        mCol.getConf().put("sortType",fSortTypes[mOrder]);
        AnkiDroidApp.getSharedPrefs(getBaseContext()).edit().putBoolean("cardBrowserNoSorting",false).commit();
      }
      if (fSortTypes[mOrder].equals("noteFld")) {
        mOrderAsc=true;
      }
      mCol.getConf().put("sortBackwards",mOrderAsc);
    }
 catch (    JSONException e) {
      throw new RuntimeException(e);
    }
    searchCards();
  }
 else   if (which != CARD_ORDER_NONE) {
    mOrderAsc=!mOrderAsc;
    try {
      mCol.getConf().put("sortBackwards",mOrderAsc);
    }
 catch (    JSONException e) {
      throw new RuntimeException(e);
    }
    Collections.reverse(mCards);
    updateList();
  }
}
}
);
dialog=builder.create();
break;
case DIALOG_CONTEXT_MENU:
String[] entries=new String[4];
@SuppressWarnings("unused") MenuItem item;
entries[CONTEXT_MENU_MARK]=res.getString(R.string.card_browser_mark_card);
entries[CONTEXT_MENU_SUSPEND]=res.getString(R.string.card_browser_suspend_card);
entries[CONTEXT_MENU_DELETE]=res.getString(R.string.card_browser_delete_card);
entries[CONTEXT_MENU_DETAILS]=res.getString(R.string.card_browser_card_details);
builder.setTitle("contextmenu");
builder.setIcon(R.drawable.ic_menu_manage);
builder.setItems(entries,mContextMenuListener);
dialog=builder.create();
break;
case DIALOG_TAGS:
allTags=mCol.getTags().all().toArray(new String[0]);
builder.setTitle(R.string.studyoptions_limit_select_tags);
builder.setMultiChoiceItems(allTags,new boolean[allTags.length],new DialogInterface.OnClickListener(){
@Override public void onClick(DialogInterface dialog,int which){
String tag=allTags[which];
if (mSelectedTags.contains(tag)) {
Log.i(AnkiDroidApp.TAG,"unchecked tag: " + tag);
mSelectedTags.remove(tag);
}
 else {
Log.i(AnkiDroidApp.TAG,"checked tag: " + tag);
mSelectedTags.add(tag);
}
}
}
,new OnCheckedChangeListener(){
@Override public void onCheckedChanged(CompoundButton buttonView,boolean isChecked){
mTagsDialog.setItemListChecked(isChecked);
mSelectedTags=new HashSet<String>(mTagsDialog.getCheckedItems());
}
}
);
builder.setPositiveButton(res.getString(R.string.select),new OnClickListener(){
@Override public void onClick(DialogInterface dialog,int which){
mSearchView.setQuery("",false);
String tags=mSelectedTags.toString();
mSearchView.setQueryHint(getResources().getString(R.string.card_browser_tags_shown,tags.substring(1,tags.length() - 1)));
StringBuilder sb=new StringBuilder();
for (String tag : mSelectedTags) {
sb.append("tag:").append(tag).append(" ");
}
mSearchTerms=sb.toString();
searchCards();
}
}
);
builder.setNegativeButton(res.getString(R.string.dialog_cancel),new OnClickListener(){
@Override public void onClick(DialogInterface dialog,int which){
mSelectedTags.clear();
}
}
);
builder.setOnCancelListener(new OnCancelListener(){
@Override public void onCancel(DialogInterface dialog){
mSelectedTags.clear();
}
}
);
mTagsDialog=builder.create();
dialog=mTagsDialog;
break;
}
return dialog;
}
