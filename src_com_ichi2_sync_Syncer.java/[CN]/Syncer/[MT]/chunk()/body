{
  JSONObject buf=new JSONObject();
  try {
    buf.put("done",false);
    int lim=2500;
    while (!mTablesLeft.isEmpty() && lim > 0) {
      String curTable=mTablesLeft.getFirst();
      if (mCursor == null) {
        mCursor=cursorForTable(curTable);
      }
      JSONArray rows=new JSONArray();
      while (mCursor.moveToNext()) {
        JSONArray r=new JSONArray();
        int count=mCursor.getColumnCount();
        for (int i=0; i < count; i++) {
          int type=mCursor.getType(i);
switch (type) {
case Cursor.FIELD_TYPE_STRING:
            r.put(mCursor.getString(i));
          break;
case Cursor.FIELD_TYPE_FLOAT:
        r.put(mCursor.getDouble(i));
      break;
case Cursor.FIELD_TYPE_INTEGER:
    r.put(mCursor.getLong(i));
  break;
}
}
rows.put(r);
}
int fetched=rows.length();
if (fetched != lim) {
mTablesLeft.removeFirst();
mCursor.close();
mCursor=null;
if (!mCol.getServer()) {
mCol.getDb().getDatabase().execSQL("UPDATE " + curTable + " SET usn="+ mMaxUsn+ " WHERE usn=-1");
}
}
buf.put(curTable,rows);
lim-=fetched;
}
if (mTablesLeft.isEmpty()) {
buf.put("done",true);
}
}
 catch (JSONException e) {
throw new RuntimeException(e);
}
return buf;
}
