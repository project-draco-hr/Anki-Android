{
  AppWidgetManager manager=AppWidgetManager.getInstance(context);
  int[] ids=manager.getAppWidgetIds(new ComponentName(context,AnkiDroidWidgetSmall.class));
  for (  int id : ids) {
    AppWidgetProviderInfo providerInfo=manager.getAppWidgetInfo(id);
    final float scale=context.getResources().getDisplayMetrics().density;
    float scaledDensity=context.getResources().getDisplayMetrics().scaledDensity;
    int[] dimensions=AnkiDroidApp.getCompat().getWidgetDimensions(manager,id);
    if (dimensions != null && dimensions.length == 4) {
      float width, height;
      if (context.getResources().getConfiguration().orientation == Configuration.ORIENTATION_PORTRAIT) {
        width=dimensions[0];
        height=dimensions[3];
      }
 else {
        width=dimensions[1];
        height=dimensions[2];
      }
      int horizontal, vertical;
      float text;
      if ((width / height) > 0.8) {
        horizontal=(int)(((width - (height * 0.8)) / 2 + 4) * scale + 0.5f);
        vertical=(int)(4 * scale + 0.5f);
        text=(float)(Math.sqrt(height * 0.8 / width) * 18);
      }
 else {
        vertical=(int)(((height - (width * 1.25)) / 2 + 4) * scale + 0.5f);
        horizontal=(int)(4 * scale + 0.5f);
        text=(float)(Math.sqrt(width * 1.25 / height) * 18);
      }
      AnkiDroidApp.getCompat().adjustSmallWidgetDimensions(updateViews,R.id.ankidroid_widget_text_layout,horizontal,vertical,horizontal,vertical,text);
    }
  }
}
