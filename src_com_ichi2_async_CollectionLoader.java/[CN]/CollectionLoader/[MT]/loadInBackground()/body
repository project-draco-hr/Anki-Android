{
  Resources res=AnkiDroidApp.getInstance().getBaseContext().getResources();
  String colPath=AnkiDroidApp.getCollectionPath();
  if (BackupManager.safetyBackupNeeded(colPath)) {
    setProgressMessage(res.getString(R.string.backup_collection));
    BackupManager.performBackup(colPath);
  }
  setProgressMessage(res.getString(R.string.open_collection));
  try {
    return AnkiDroidApp.openCollection(colPath);
  }
 catch (  RuntimeException e) {
    BackupManager.restoreCollectionIfMissing(colPath);
    Log.e(AnkiDroidApp.TAG,"doInBackgroundOpenCollection - RuntimeException on opening collection: " + e);
    AnkiDroidApp.saveExceptionReportFile(e,"doInBackgroundOpenCollection");
    return null;
  }
}
