{
  String dir=null;
  File mediaDir=null;
  if (mDeckPath != null && !mDeckPath.equals("")) {
    Log.i(AnkiDroidApp.TAG,"mediaDir - mediaPrefix = " + mMediaPrefix);
    if (mMediaPrefix != null) {
      dir=mMediaPrefix + "/" + mDeckName+ ".media";
    }
 else {
      dir=mDeckPath.replaceAll("\\.anki$",".media");
    }
    if (rename) {
      return dir;
    }
    mediaDir=new File(dir);
    if (!mediaDir.exists() && create) {
      try {
        if (!mediaDir.mkdir()) {
          Log.e(AnkiDroidApp.TAG,"Couldn't create media directory " + dir);
          return null;
        }
      }
 catch (      SecurityException e) {
        Log.e(AnkiDroidApp.TAG,"Security restriction: Couldn't create media directory " + dir);
        return null;
      }
    }
  }
  if (dir == null) {
    return null;
  }
 else {
    if (!mediaDir.exists() || !mediaDir.isDirectory()) {
      return null;
    }
  }
  Log.i(AnkiDroidApp.TAG,"mediaDir - mediaDir = " + dir);
  return dir;
}
