{
  JSONObject[] cms=findTemplates(fact);
  if (cms.length == 0) {
    return 0;
  }
  fact.setId(nextID("fid"));
  fact.flush();
  int due;
  if (randomNew()) {
    due=new Random().nextInt(fact.getId());
  }
 else {
    due=fact.getId();
  }
  int ncards=0;
  for (  JSONObject template : cms) {
    _newCard(fact,template,due);
    ncards+=1;
  }
  return ncards;
}
