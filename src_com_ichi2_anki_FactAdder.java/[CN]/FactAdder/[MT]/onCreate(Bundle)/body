{
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  registerExternalStorageListener();
  View mainView=getLayoutInflater().inflate(R.layout.fact_adder,null);
  setContentView(mainView);
  Themes.setWallpaper(mainView);
  mFieldsLayoutContainer=(LinearLayout)findViewById(R.id.FactAdderEditFieldsLayout);
  Themes.setTextViewStyle(mFieldsLayoutContainer);
  mAddButton=(Button)findViewById(R.id.FactAdderAddButton);
  mCloseButton=(Button)findViewById(R.id.FactAdderCloseButton);
  mModelButton=(Button)findViewById(R.id.FactAdderModelButton);
  mCardModelButton=(Button)findViewById(R.id.FactAdderCardModelButton);
  mTags=(Button)findViewById(R.id.FactAdderTagButton);
  mTags.setText(getResources().getString(R.string.CardEditorTags,mFactTags));
  mDeck=AnkiDroidApp.deck();
  mModels=Model.getModels(mDeck);
  mCurrentSelectedModelId=mDeck.getCurrentModelId();
  mNewSelectedCardModels=new LinkedHashMap<Long,CardModel>();
  cardModelIds=new ArrayList<Long>();
  modelChanged();
  mAddButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      for (      FieldEditText current : mEditFields) {
        current.updateField();
      }
      mNewFact.setTags(mFactTags);
      DeckTask.launchDeckTask(DeckTask.TASK_TYPE_ADD_FACT,mSaveFactHandler,new DeckTask.TaskData(mDeck,mNewFact,mSelectedCardModels));
    }
  }
);
  mModelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      showDialog(DIALOG_MODEL_SELECT);
    }
  }
);
  mCardModelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      recreateCardModelDialog();
      mCardModelDialog.show();
    }
  }
);
  mCloseButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      closeFactAdder();
    }
  }
);
  allTags=null;
  mSelectedTags=new HashSet<String>();
  mTags.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      recreateTagsDialog();
      if (!mTagsDialog.isShowing()) {
        mTagsDialog.show();
      }
    }
  }
);
  initDialogs();
}
