{
  super.onCreate(savedInstanceState);
  Resources res=getResources();
  registerExternalStorageListener();
  setContentView(R.layout.fact_adder);
  mFieldsLayoutContainer=(LinearLayout)findViewById(R.id.FactAdderEditFieldsLayout);
  mAddButton=(Button)findViewById(R.id.FactAdderAddButton);
  mCloseButton=(Button)findViewById(R.id.FactAdderCloseButton);
  mModelButton=(Button)findViewById(R.id.FactAdderModelButton);
  mCardTemplates=(TextView)findViewById(R.id.FactAdderTemplates);
  mDeck=AnkiDroidApp.deck();
  mModels=Model.getModels(mDeck);
  mCurrentSelectedModelId=mDeck.getCurrentModelId();
  mModelButton.setText(mModels.get(mCurrentSelectedModelId).getName());
  String templates=mModels.get(mCurrentSelectedModelId).getCardModelNames();
  if (templates.indexOf(", ") == -1) {
    mCardTemplates.setText(res.getString(R.string.card) + " " + templates);
  }
 else {
    mCardTemplates.setText(res.getString(R.string.cards) + " " + templates);
  }
  mNewFact=mDeck.newFact();
  populateEditFields();
  mAddButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      for (      FieldEditText current : mEditFields) {
        current.updateField();
      }
      mDeck.addFact(mNewFact);
      setResult(RESULT_OK);
      finish();
    }
  }
);
  mModelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      showDialog(DIALOG_MODEL_SELECT);
    }
  }
);
  mCloseButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      setResult(RESULT_CANCELED);
      finish();
    }
  }
);
}
