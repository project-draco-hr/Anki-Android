{
  super.onCreate(savedInstanceState);
  registerExternalStorageListener();
  setContentView(R.layout.fact_adder);
  mFieldsLayoutContainer=(LinearLayout)findViewById(R.id.FactAdderEditFieldsLayout);
  mAddButton=(Button)findViewById(R.id.FactAdderAddButton);
  mCloseButton=(Button)findViewById(R.id.FactAdderCloseButton);
  mModelButton=(Button)findViewById(R.id.FactAdderModelButton);
  mCardModelButton=(Button)findViewById(R.id.FactAdderCardModelButton);
  mTags=(Button)findViewById(R.id.FactAdderTagButton);
  mTags.setText(getResources().getString(R.string.CardEditorTags,mFactTags));
  mDeck=AnkiDroidApp.deck();
  mModels=Model.getModels(mDeck);
  mCurrentSelectedModelId=mDeck.getCurrentModelId();
  mNewSelectedCardModels=new TreeMap<Long,CardModel>();
  cardModelIds=new ArrayList<Long>();
  modelChanged();
  mAddButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      for (      FieldEditText current : mEditFields) {
        current.updateField();
      }
      mDeck.addFact(mNewFact,mSelectedCardModels);
      setResult(RESULT_OK);
      closeFactAdder();
    }
  }
);
  mModelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      showDialog(DIALOG_MODEL_SELECT);
    }
  }
);
  mCardModelButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      recreateCardModelDialog();
      mCardModelDialog.show();
    }
  }
);
  mCloseButton.setOnClickListener(new View.OnClickListener(){
    public void onClick(    View v){
      setResult(RESULT_CANCELED);
      closeFactAdder();
    }
  }
);
  allTags=new String[0];
  mSelectedTags=new HashSet<String>();
  mTags.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      recreateTagsDialog();
      if (!mTagsDialog.isShowing()) {
        mTagsDialog.show();
      }
    }
  }
);
  initDialogs();
}
