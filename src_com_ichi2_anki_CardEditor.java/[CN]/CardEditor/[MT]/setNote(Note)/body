{
  try {
    if (note == null) {
      mCurrentDid=mCol.getDecks().current().getLong("id");
      if (mCol.getDecks().isDyn(mCurrentDid)) {
        mCurrentDid=1;
      }
      JSONObject model=mCol.getModels().current();
      mEditorNote=new Note(mCol,model);
      mEditorNote.model().put("did",mCurrentDid);
      mModelButton.setText(getResources().getString(R.string.CardEditorModel,model.getString("name")));
      JSONArray tags=model.getJSONArray("tags");
      for (int i=0; i < tags.length(); i++) {
        mEditorNote.addTag(tags.getString(i));
      }
    }
 else {
      mEditorNote=note;
      mCurrentDid=mCurrentEditedCard.getDid();
    }
  }
 catch (  JSONException e) {
    throw new RuntimeException(e);
  }
  mCurrentTags=mEditorNote.getTags();
  updateDeck();
  updateTags();
  populateEditFields();
  swapText(true);
}
