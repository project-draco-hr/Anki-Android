{
  super.onCreate(savedInstanceState);
  registerExternalStorageListener();
  setContentView(R.layout.card_editor);
  mFieldsLayoutContainer=(LinearLayout)findViewById(R.id.CardEditorEditFieldsLayout);
  mSave=(Button)findViewById(R.id.CardEditorSaveButton);
  mCancel=(Button)findViewById(R.id.CardEditorCancelButton);
  mTags=(Button)findViewById(R.id.CardEditorTagButton);
  if (getIntent().getBooleanExtra("callfromcardbrowser",false)) {
    mEditorCard=CardBrowser.getEditorCard();
  }
 else {
    mEditorCard=Reviewer.getEditorCard();
  }
  mEditorFact=mEditorCard.getFact();
  mTags.setText(getResources().getString(R.string.CardEditorTags,mFactTags));
  mTags.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      recreateTagsDialog();
      if (!mTagsDialog.isShowing()) {
        mTagsDialog.show();
      }
    }
  }
);
  allTags=null;
  mSelectedTags=new HashSet<String>();
  mSave.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (mModified) {
        setResult(RESULT_OK);
      }
 else {
        setResult(RESULT_CANCELED);
      }
      closeCardEditor();
    }
  }
);
  mCancel.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      setResult(RESULT_CANCELED);
      closeCardEditor();
    }
  }
);
  initDialogs();
}
