{
  StringBuilder sb=new StringBuilder(latex);
  Matcher namedEntity=htmlNamedEntityPattern.matcher(sb);
  while (namedEntity.find()) {
    sb.replace(namedEntity.begin(),namedEntity.end(),Html.fromHtml(namedEntity.group()).toString());
    namedEntity=htmlNamedEntityPattern.matcher(sb);
  }
  latex=sb.toString();
  latex=sBRPattern.matcher(latex).replaceAll("\n");
  latex=deck.getVar("latexPre") + "\n" + latex+ "\n"+ deck.getVar("latexPost");
  return latex;
}
