{
  Log.i(AnkiDroidApp.TAG,"doInBackgroundOpenCollection");
  Resources res=AnkiDroidApp.getInstance().getBaseContext().getResources();
  String collectionFile=params[0].getString();
  Collection oldCol=Collection.currentCollection();
  boolean reset=params[0].getBoolean();
  Collection col=null;
  if (oldCol == null || !oldCol.getPath().equals(collectionFile)) {
    if (BackupManager.safetyBackupNeeded(collectionFile)) {
      publishProgress(new TaskData(res.getString(R.string.backup_collection)));
      BackupManager.performBackup(collectionFile);
    }
    publishProgress(new TaskData(res.getString(R.string.open_collection)));
    Log.i(AnkiDroidApp.TAG,"doInBackgroundOpenCollection - File exists -> Loading collection...");
    col=Collection.openCollection(collectionFile);
    SharedPreferences prefs=PrefSettings.getSharedPrefs(AnkiDroidApp.getInstance().getBaseContext());
    if (prefs.contains("createTutorial") && prefs.getBoolean("createTutorial",false)) {
      prefs.edit().remove("createTutorial").commit();
      publishProgress(new TaskData(res.getString(R.string.tutorial_load)));
      doInBackgroundLoadTutorial(new TaskData(col));
    }
  }
 else {
    Log.i(AnkiDroidApp.TAG,"doInBackgroundOpenCollection: collection still open - reusing it");
    col=oldCol;
  }
  if (col == null) {
    return new TaskData(col);
  }
  if (reset) {
    col.getSched().reset();
  }
  TreeSet<Object[]> decks=col.getSched().deckDueTree(false);
  return new TaskData(col,decks,0);
}
