{
  Sched sched=params[0].getSched();
  Collection col=sched.getCol();
  Card editCard=params[0].getCard();
  Note editNote=editCard.getNote();
  boolean showQuestion=params[0].getBoolean();
  try {
    col.getDb().getDatabase().beginTransaction();
    try {
      editNote.flush();
      editCard.flush();
      Card newCard;
      if (col.getDecks().active().contains(editCard.getDid())) {
        newCard=editCard;
        newCard.getQuestion(true);
      }
 else {
        newCard=sched.getCard();
      }
      publishProgress(new TaskData(null,newCard,showQuestion));
      col.getDb().getDatabase().setTransactionSuccessful();
    }
  finally {
      col.getDb().getDatabase().endTransaction();
    }
  }
 catch (  RuntimeException e) {
    Log.e(AnkiDroidApp.TAG,"doInBackgroundUpdateFact - RuntimeException on updating fact: " + e);
    AnkiDroidApp.saveExceptionReportFile(e,"doInBackgroundUpdateFact");
    return new TaskData(false);
  }
  return new TaskData(true);
}
