{
  try {
    if (!mPreOperationDone) {
      mListener.onPreExecute();
      mPreOperationDone=true;
    }
    if ((sOldInstance != null) && (sOldInstance.getStatus() != AsyncTask.Status.FINISHED)) {
      if (mType == TASK_TYPE_OPEN_COLLECTION && sOldInstance.mType == TASK_TYPE_CLOSE_DECK) {
        publishProgress(new TaskData(AnkiDroidApp.getInstance().getBaseContext().getResources().getString(R.string.finish_operation)));
      }
      sOldInstance.get();
    }
  }
 catch (  Exception e) {
    Log.e(AnkiDroidApp.TAG,"doInBackground - Got exception while waiting for thread to finish: " + e.getMessage());
  }
switch (mType) {
case TASK_TYPE_OPEN_COLLECTION:
    return doInBackgroundOpenCollection(params);
case TASK_TYPE_LOAD_DECK_COUNTS:
  return doInBackgroundLoadDeckCounts(params);
case TASK_TYPE_SAVE_COLLECTION:
return doInBackgroundSaveCollection(params);
case TASK_TYPE_ANSWER_CARD:
return doInBackgroundAnswerCard(params);
case TASK_TYPE_MARK_CARD:
return doInBackgroundMarkCard(params);
case TASK_TYPE_ADD_FACT:
return doInBackgroundAddNote(params);
case TASK_TYPE_UPDATE_FACT:
return doInBackgroundUpdateNote(params);
case TASK_TYPE_UNDO:
return doInBackgroundUndo(params);
case TASK_TYPE_SEARCH_CARDS:
return doInBackgroundSearchCards(params);
case TASK_TYPE_DISMISS_NOTE:
return doInBackgroundDismissNote(params);
case TASK_TYPE_LOAD_STATISTICS:
return doInBackgroundLoadStatistics(params);
case TASK_TYPE_CHECK_DATABASE:
return doInBackgroundCheckDatabase(params);
case TASK_TYPE_DELETE_BACKUPS:
return doInBackgroundDeleteBackups();
case TASK_TYPE_RESTORE_DECK:
return doInBackgroundRestoreDeck(params);
case TASK_TYPE_UPDATE_CARD_BROWSER_LIST:
return doInBackgroundUpdateCardBrowserList(params);
case TASK_TYPE_LOAD_TUTORIAL:
return doInBackgroundLoadTutorial(params);
case TASK_TYPE_REPAIR_DECK:
return doInBackgroundRepairDeck(params);
case TASK_TYPE_CLOSE_DECK:
return doInBackgroundCloseCollection(params);
case TASK_TYPE_UPDATE_VALUES_FROM_DECK:
return doInBackgroundUpdateValuesFromDeck(params);
case TASK_TYPE_RESTORE_IF_MISSING:
return doInBackgroundRestoreIfMissing(params);
case TASK_TYPE_DELETE_DECK:
return doInBackgroundDeleteDeck(params);
case TASK_TYPE_REBUILD_CRAM:
return doInBackgroundRebuildCram(params);
case TASK_TYPE_EMPTY_CRAM:
return doInBackgroundEmptyCram(params);
case TASK_TYPE_IMPORT:
return doInBackgroundImport(params);
case TASK_TYPE_IMPORT_REPLACE:
return doInBackgroundImportReplace(params);
default :
return null;
}
}
