{
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  restorePreferences();
  Resources res=getResources();
  mStats=Stats.currentStats();
  mSeriesList=mStats.getSeriesList();
  Object[] ob=mStats.getMetaInfo();
  String title=res.getString((Integer)ob[1]);
  boolean backwards=(Boolean)ob[2];
  int[] valueLabels=(int[])ob[3];
  int[] barColors=(int[])ob[4];
  int[] axisTitles=(int[])ob[5];
  String subTitle=(String)ob[6];
  if (mSeriesList == null || mSeriesList[0].length < 2) {
    Log.i(AnkiDroidApp.TAG,"ChartBuilder - Data variable empty, closing chartbuilder");
    finish();
    return;
  }
  if (mFullScreen) {
    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);
    requestWindowFeature(Window.FEATURE_NO_TITLE);
  }
  View mainView=getLayoutInflater().inflate(R.layout.statistics,null);
  setContentView(mainView);
  mainView.setBackgroundColor(Color.WHITE);
  mTitle=(TextView)findViewById(R.id.statistics_title);
  if (mChartView == null) {
    if (mFullScreen) {
      mTitle.setText(title);
      mTitle.setTextColor(Color.BLACK);
    }
 else {
      setTitle(title);
      UIUtils.setActionBarSubtitle(this,subTitle);
      mTitle.setVisibility(View.GONE);
    }
    for (int i=1; i < mSeriesList.length; i++) {
      XYSeries series=new XYSeries(res.getString(valueLabels[i - 1]));
      for (int j=0; j < mSeriesList[i].length; j++) {
        series.add(mSeriesList[0][j],mSeriesList[i][j]);
      }
      mDataset.addSeries(series);
      XYSeriesRenderer renderer=new XYSeriesRenderer();
      renderer.setColor(res.getColor(barColors[i - 1]));
      mRenderer.addSeriesRenderer(renderer);
    }
    if (mSeriesList.length == 1) {
      mRenderer.setShowLegend(false);
    }
    if (backwards) {
      mPan=new double[]{mSeriesList[0][0] - 0.5,0.5};
    }
 else {
      mPan=new double[]{-0.5,mSeriesList[0][mSeriesList[0].length - 1] + 0.5};
    }
    mRenderer.setLegendTextSize(17);
    mRenderer.setBarSpacing(0.4);
    mRenderer.setLegendHeight(60);
    mRenderer.setAxisTitleTextSize(17);
    mRenderer.setLabelsTextSize(17);
    mRenderer.setXAxisMin(mPan[0]);
    mRenderer.setXAxisMax(mPan[1]);
    mRenderer.setYAxisMin(0);
    mRenderer.setGridColor(Color.LTGRAY);
    mRenderer.setShowGrid(true);
    mRenderer.setXTitle(res.getStringArray(R.array.due_x_axis_title)[axisTitles[0]]);
    mRenderer.setYTitle(res.getString(axisTitles[1]));
    mRenderer.setBackgroundColor(Color.WHITE);
    mRenderer.setMarginsColor(Color.WHITE);
    mRenderer.setAxesColor(Color.BLACK);
    mRenderer.setLabelsColor(Color.BLACK);
    mRenderer.setYLabelsColor(0,Color.BLACK);
    mRenderer.setYLabelsAngle(-90);
    mRenderer.setXLabelsColor(Color.BLACK);
    mRenderer.setXLabelsAlign(Align.CENTER);
    mRenderer.setYLabelsAlign(Align.CENTER);
    mRenderer.setZoomEnabled(false,false);
    mRenderer.setMargins(new int[]{15,48,30,10});
    mRenderer.setAntialiasing(true);
    mRenderer.setPanEnabled(true,false);
    mRenderer.setPanLimits(mPan);
    mChartView=ChartFactory.getBarChartView(this,mDataset,mRenderer,BarChart.Type.STACKED);
    LinearLayout layout=(LinearLayout)findViewById(R.id.chart);
    layout.addView(mChartView,new LayoutParams(LayoutParams.FILL_PARENT,LayoutParams.FILL_PARENT));
  }
 else {
    mChartView.repaint();
  }
  gestureDetector=new GestureDetector(new MyGestureDetector());
  mChartView.setOnTouchListener(new View.OnTouchListener(){
    public boolean onTouch(    View v,    MotionEvent event){
      if (gestureDetector.onTouchEvent(event)) {
        return true;
      }
      return false;
    }
  }
);
}
