{
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  restorePreferences();
  mStats=Stats.currentStats();
  mSeriesList=mStats.getSeriesList();
  if (mSeriesList == null || mSeriesList[0].length < 2) {
    Log.i(AnkiDroidApp.TAG,"ChartBuilder - Data variable empty, closing chartbuilder");
    finish();
    return;
  }
  if (mFullScreen) {
    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);
    requestWindowFeature(Window.FEATURE_NO_TITLE);
  }
  View mainView=getLayoutInflater().inflate(R.layout.statistics,null);
  setContentView(mainView);
  int[] colors=Themes.getChartColors();
  mainView.setBackgroundColor(colors[1]);
  mTitle=(TextView)findViewById(R.id.statistics_title);
  if (mChartView == null) {
    if (mFullScreen) {
      mTitle.setText("due");
      mTitle.setTextColor(colors[0]);
    }
 else {
      mTitle.setVisibility(View.GONE);
    }
    for (int i=1; i < mSeriesList.length; i++) {
      XYSeries series=new XYSeries("a (" + i + ")");
      for (int j=0; j < mSeriesList[i].length; j++) {
        series.add(mSeriesList[0][j],mSeriesList[i][j]);
      }
      mDataset.addSeries(series);
      setRenderer(0,i - 1);
    }
    if (mSeriesList.length == 1) {
      mRenderer.setShowLegend(false);
    }
    mPan=new double[]{mSeriesList[0][0] - 1,mSeriesList[0][mSeriesList[0].length - 1] + 1};
    mRenderer.setLegendTextSize(17);
    mRenderer.setBarSpacing(0.3);
    mRenderer.setLegendHeight(60);
    mRenderer.setAxisTitleTextSize(17);
    mRenderer.setLabelsTextSize(17);
    mRenderer.setXAxisMin(mPan[0]);
    mRenderer.setXAxisMax(mPan[1]);
    mRenderer.setYAxisMin(0);
    mRenderer.setBackgroundColor(colors[1]);
    mRenderer.setMarginsColor(colors[1]);
    mRenderer.setAxesColor(colors[0]);
    mRenderer.setLabelsColor(colors[0]);
    mRenderer.setZoomEnabled(false,false);
    mRenderer.setMargins(new int[]{15,42,25,0});
    mRenderer.setPanEnabled(true,false);
    mRenderer.setPanLimits(mPan);
    mRenderer.setXLabelsAlign(Align.CENTER);
    mRenderer.setYLabelsAlign(Align.RIGHT);
    mChartView=ChartFactory.getBarChartView(this,mDataset,mRenderer,BarChart.Type.STACKED);
    LinearLayout layout=(LinearLayout)findViewById(R.id.chart);
    layout.addView(mChartView,new LayoutParams(LayoutParams.FILL_PARENT,LayoutParams.FILL_PARENT));
  }
 else {
    mChartView.repaint();
  }
  gestureDetector=new GestureDetector(new MyGestureDetector());
  mChartView.setOnTouchListener(new View.OnTouchListener(){
    public boolean onTouch(    View v,    MotionEvent event){
      if (gestureDetector.onTouchEvent(event)) {
        return true;
      }
      return false;
    }
  }
);
  if (zoom > 0) {
    zoom();
  }
}
