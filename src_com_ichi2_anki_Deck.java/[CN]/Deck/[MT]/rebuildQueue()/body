{
  Cursor cursor=null;
  Log.i(AnkiDroidApp.TAG,"rebuildQueue - Rebuilding query...");
  mGlobalStats=Stats.globalStats(this);
  mDailyStats=Stats.dailyStats(this);
  checkDue();
  if (mNewCardSpacing == NEW_CARDS_DISTRIBUTE) {
    if (mNewCountToday > 0) {
      mNewCardModulus=(mNewCountToday + mRevCount) / mNewCountToday;
      if (mRevCount > 0) {
        mNewCardModulus=Math.max(2,mNewCardModulus);
      }
    }
 else {
      mNewCardModulus=0;
    }
  }
 else {
    mNewCardModulus=0;
  }
  Log.i(AnkiDroidApp.TAG,"newCardModulus set to " + mNewCardModulus);
  try {
    cursor=AnkiDatabaseManager.getDatabase(mDeckPath).getDatabase().rawQuery("SELECT avg(factor) " + "FROM cards " + "WHERE type = 1",null);
    if (!cursor.moveToFirst()) {
      mAverageFactor=Deck.initialFactor;
    }
 else {
      mAverageFactor=cursor.getDouble(0);
    }
  }
  finally {
    if (cursor != null) {
      cursor.close();
    }
  }
  mAverageFactor=Math.max(mAverageFactor,minimumAverage);
}
