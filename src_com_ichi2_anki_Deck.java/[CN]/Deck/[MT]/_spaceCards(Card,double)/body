{
  Cursor cursor=null;
  try {
    cursor=getDB().getDatabase().rawQuery("SELECT type, count(type) FROM cards WHERE factId = " + card.getFactId() + " AND combinedDue < "+ dueCutoff+ " AND id != "+ card.getId()+ " GROUP BY type",null);
    while (cursor.moveToNext()) {
      Log.i(AnkiDroidApp.TAG,"failedSoonCount before = " + mFailedSoonCount);
      Log.i(AnkiDroidApp.TAG,"revCount before = " + mRevCount);
      Log.i(AnkiDroidApp.TAG,"newCount before = " + mNewCount);
      int type=cursor.getInt(0);
      int count=cursor.getInt(1);
      if (type == 0) {
        mFailedSoonCount-=count;
      }
 else       if (type == 1) {
        mRevCount-=count;
      }
 else       if (type == 2) {
        mNewCount-=count;
      }
      Log.i(AnkiDroidApp.TAG,"failedSoonCount after = " + mFailedSoonCount);
      Log.i(AnkiDroidApp.TAG,"revCount after = " + mRevCount);
      Log.i(AnkiDroidApp.TAG,"newCount after = " + mNewCount);
    }
  }
  finally {
    if (cursor != null) {
      cursor.close();
    }
  }
  getDB().getDatabase().execSQL(String.format(Utils.ENGLISH_LOCALE,"UPDATE cards SET spaceUntil = %f, " + "combinedDue = max(%f, due), modified = %f, isDue = 0 WHERE id != %d and factId = %d",space,space,Utils.now(),card.getId(),card.getFactId()));
  spacedFacts.put(card.getFactId(),space);
}
