{
  Log.i(TAG,"deleteCards = " + ids.toString());
  int len=ids.size();
  if (len > 0) {
    AnkiDb ankiDB=AnkiDatabaseManager.getDatabase(deckPath);
    commitToDB();
    double now=System.currentTimeMillis() / 1000.0;
    Log.i(TAG,"Now = " + now);
    String idsString=Utils.ids2str(ids);
    ankiDB.database.execSQL("DELETE FROM cards WHERE id in " + idsString);
    String sqlInsert="INSERT INTO cardsDeleted values (?," + String.format(ENGLISH_LOCALE,"%f",now) + ")";
    SQLiteStatement statement=ankiDB.database.compileStatement(sqlInsert);
    for (int i=0; i < len; i++) {
      statement.bindString(1,ids.get(i));
      statement.executeInsert();
    }
    statement.close();
    ArrayList<String> tags=ankiDB.queryColumn(String.class,"SELECT tagId FROM cardTags WHERE cardId in " + idsString,0);
    ankiDB.database.execSQL("DELETE FROM cardTags WHERE cardId in " + idsString);
    ArrayList<String> unusedTags=new ArrayList<String>();
    for (int i=0; i < tags.size(); i++) {
      String tagId=tags.get(i);
      Cursor cursor=ankiDB.database.rawQuery("SELECT * FROM cardTags WHERE tagId = " + tagId + " LIMIT 1",null);
      if (!cursor.moveToFirst()) {
        unusedTags.add(tagId);
      }
      cursor.close();
    }
    ankiDB.database.execSQL("DELETE FROM tags WHERE id in " + Utils.ids2str(unusedTags) + " and priority = 2");
    deleteDanglingFacts();
    rebuildCounts(true);
    flushMod();
  }
}
