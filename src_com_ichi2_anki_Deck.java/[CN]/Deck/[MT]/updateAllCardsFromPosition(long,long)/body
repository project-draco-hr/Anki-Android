{
  AnkiDb ankiDB=AnkiDatabaseManager.getDatabase(deckPath);
  Cursor cursor=ankiDB.database.rawQuery("SELECT id, factId " + "FROM cards " + "ORDER BY factId, id "+ "LIMIT " + limitCards + " OFFSET "+ numUpdatedCards,null);
  ankiDB.database.beginTransaction();
  try {
    while (cursor.moveToNext()) {
      Card card=new Card(this);
      card.fromDB(cursor.getLong(0));
      Log.i(AnkiDroidApp.TAG,"Card id = " + card.id + ", numUpdatedCards = "+ numUpdatedCards);
      card.loadTags();
      Fact fact=card.getFact();
      HashMap<String,String> newQA=CardModel.formatQA(fact,card.getCardModel(),card.splitTags());
      card.question=newQA.get("question");
      Log.i(AnkiDroidApp.TAG,"Question = " + card.question);
      card.answer=newQA.get("answer");
      Log.i(AnkiDroidApp.TAG,"Answer = " + card.answer);
      card.modified=System.currentTimeMillis() / 1000.0;
      card.updateQAfields();
      numUpdatedCards++;
    }
    cursor.close();
    ankiDB.database.setTransactionSuccessful();
  }
  finally {
    ankiDB.database.endTransaction();
  }
  return numUpdatedCards;
}
