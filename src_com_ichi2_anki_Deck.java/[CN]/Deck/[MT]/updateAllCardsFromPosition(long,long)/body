{
  Cursor cursor=getDB().database.rawQuery("SELECT id, factId " + "FROM cards " + "ORDER BY factId, id "+ "LIMIT " + limitCards + " OFFSET "+ numUpdatedCards,null);
  getDB().database.beginTransaction();
  try {
    while (cursor.moveToNext()) {
      Card card=new Card(this);
      card.fromDB(cursor.getLong(0));
      Log.i(TAG,"Card id = " + card.id + ", numUpdatedCards = "+ numUpdatedCards);
      card.loadTags();
      Fact fact=card.getFact();
      HashMap<String,String> newQA=CardModel.formatQA(fact,card.getCardModel(),card.splitTags());
      card.question=newQA.get("question");
      Log.i(TAG,"Question = " + card.question);
      card.answer=newQA.get("answer");
      Log.i(TAG,"Answer = " + card.answer);
      card.modified=System.currentTimeMillis() / 1000.0;
      card.updateQAfields();
      numUpdatedCards++;
    }
    cursor.close();
    getDB().database.setTransactionSuccessful();
  }
  finally {
    getDB().database.endTransaction();
  }
  return numUpdatedCards;
}
