{
  double interval=card.interval;
  double factor=card.factor;
  if ((delay < 0) && (card.successive != 0)) {
    interval=Math.max(card.lastInterval,card.interval + delay);
    if (interval < midIntervalMin)     interval=0;
    delay=0;
  }
  if (ease == 1) {
    interval*=delay2;
    if (interval < hardIntervalMin)     interval=0;
  }
 else   if (interval == 0) {
    if (ease == 2)     interval=hardIntervalMin + ((double)Math.random()) * (hardIntervalMax - hardIntervalMin);
 else     if (ease == 3)     interval=midIntervalMin + ((double)Math.random()) * (midIntervalMax - midIntervalMin);
 else     if (ease == 4)     interval=easyIntervalMin + ((double)Math.random()) * (easyIntervalMax - easyIntervalMin);
  }
 else {
    if ((interval < hardIntervalMax) && (interval > 0.166)) {
      double mid=(midIntervalMin + midIntervalMax) / 2.0;
      interval=mid / factor;
    }
    if (ease == 2)     interval=(interval + delay / 4.0) * 1.2;
 else     if (ease == 3)     interval=(interval + delay / 2.0) * factor;
 else     if (ease == 4)     interval=(interval + delay) * factor * factorFour;
    double fuzz=0.95 + ((double)Math.random()) * (1.05 - 0.95);
    interval*=fuzz;
  }
  if (maxScheduleTime != 0)   interval=Math.min(interval,maxScheduleTime);
  return interval;
}
