{
  final ContentResolver cr=getContext().getContentResolver();
  final Cursor allNotesCursor=cr.query(FlashCardsContract.Note.CONTENT_URI,null,"tag:" + TEST_TAG,null,null);
  assertNotNull(allNotesCursor);
  try {
    assertEquals("Check number of results",mCreatedNotes,allNotesCursor.getCount());
    while (allNotesCursor.moveToNext()) {
      Uri dataUri=Uri.withAppendedPath(Uri.withAppendedPath(FlashCardsContract.Note.CONTENT_URI,allNotesCursor.getString(allNotesCursor.getColumnIndex(FlashCardsContract.Note._ID))),"data");
      final Cursor noteDataCursor=cr.query(dataUri,null,null,null,null);
      assertNotNull("Check that there is a valid cursor for detail data",noteDataCursor);
      try {
        assertTrue("Check that there is at least one result for detail data",noteDataCursor.getCount() > 0);
        while (noteDataCursor.moveToNext()) {
          String mimeType=noteDataCursor.getString(noteDataCursor.getColumnIndex(FlashCardsContract.DataColumns.MIMETYPE));
          if (mimeType.equals(FlashCardsContract.Data.Field.CONTENT_ITEM_TYPE)) {
            assertEquals("Check field content","temp",noteDataCursor.getString(noteDataCursor.getColumnIndex(FlashCardsContract.Data.Field.FIELD_CONTENT)));
          }
 else           if (mimeType.equals(FlashCardsContract.Data.Tags.CONTENT_ITEM_TYPE)) {
            assertEquals("Unknown tag",TEST_TAG,noteDataCursor.getString(noteDataCursor.getColumnIndex(FlashCardsContract.Data.Tags.TAG_CONTENT)));
          }
 else {
            fail("Unknown MIME type " + noteDataCursor.getString(allNotesCursor.getColumnIndex(FlashCardsContract.DataColumns.MIMETYPE)));
          }
        }
      }
  finally {
        noteDataCursor.close();
      }
    }
  }
  finally {
    allNotesCursor.close();
  }
}
