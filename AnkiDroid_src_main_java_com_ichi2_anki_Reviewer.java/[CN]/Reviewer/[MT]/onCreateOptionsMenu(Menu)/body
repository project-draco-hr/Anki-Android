{
  getMenuInflater().inflate(R.menu.reviewer,menu);
  Resources res=getResources();
  if (mCurrentCard != null && mCurrentCard.note().hasTag("marked")) {
    menu.findItem(R.id.action_mark_card).setTitle(R.string.menu_unmark_note).setIcon(R.drawable.ic_star_white_24dp);
  }
 else {
    menu.findItem(R.id.action_mark_card).setTitle(R.string.menu_mark_note).setIcon(R.drawable.ic_star_outline_white_24dp);
  }
  if (colIsOpen() && getCol().undoAvailable()) {
    menu.findItem(R.id.action_undo).setEnabled(true).getIcon().setAlpha(Themes.ALPHA_ICON_ENABLED_LIGHT);
  }
 else {
    menu.findItem(R.id.action_undo).setEnabled(false).getIcon().setAlpha(Themes.ALPHA_ICON_DISABLED_LIGHT);
  }
  if (mPrefWhiteboard) {
    MenuItemCompat.setShowAsAction(menu.findItem(R.id.action_mark_card),MenuItemCompat.SHOW_AS_ACTION_IF_ROOM);
    if (CompatHelper.getSdkVersion() >= 14 && !ViewConfiguration.get(this).hasPermanentMenuKey()) {
      Display display=getWindowManager().getDefaultDisplay();
      DisplayMetrics outMetrics=new DisplayMetrics();
      display.getMetrics(outMetrics);
      float density=getResources().getDisplayMetrics().density;
      float dpWidth=outMetrics.widthPixels / density;
      if (dpWidth < 360) {
        menu.findItem(R.id.action_hide_whiteboard).setShowAsAction(MenuItem.SHOW_AS_ACTION_IF_ROOM);
      }
    }
    menu.findItem(R.id.action_enable_whiteboard).setTitle(R.string.disable_whiteboard);
    menu.findItem(R.id.action_hide_whiteboard).setVisible(true);
    menu.findItem(R.id.action_clear_whiteboard).setVisible(true);
    Drawable whiteboardIcon=ContextCompat.getDrawable(this,R.drawable.ic_gesture_white_24dp);
    if (mShowWhiteboard) {
      whiteboardIcon.setAlpha(255);
      menu.findItem(R.id.action_hide_whiteboard).setIcon(whiteboardIcon);
      menu.findItem(R.id.action_hide_whiteboard).setTitle(R.string.hide_whiteboard);
    }
 else {
      whiteboardIcon.setAlpha(77);
      menu.findItem(R.id.action_hide_whiteboard).setIcon(whiteboardIcon);
      menu.findItem(R.id.action_hide_whiteboard).setTitle(R.string.show_whiteboard);
    }
  }
 else {
    menu.findItem(R.id.action_enable_whiteboard).setTitle(R.string.enable_whiteboard);
  }
  if (!CompatHelper.isHoneycomb() && !mDisableClipboard) {
    menu.findItem(R.id.action_search_dictionary).setVisible(true).setEnabled(!(mPrefWhiteboard && mShowWhiteboard)).setTitle(clipboardHasText() ? Lookup.getSearchStringTitle() : res.getString(R.string.menu_select));
  }
  if (getCol().getDecks().isDyn(getParentDid())) {
    menu.findItem(R.id.action_open_deck_options).setVisible(false);
  }
  if (mSpeakText) {
    menu.findItem(R.id.action_select_tts).setVisible(true);
  }
  return super.onCreateOptionsMenu(menu);
}
