{
  if (percentage == 100 || null == content || 0 == content.trim().length()) {
    return content.trim();
  }
  StringBuffer sb=new StringBuffer();
  int tagDepth=0;
  int lastRelUnitnTagDepth=100;
  double doubleSize;
  int lastMatch=0;
  String contentPart;
  Matcher m2;
  Matcher m=fFontSizePattern.matcher(content);
  while (m.find()) {
    contentPart=content.substring(lastMatch,m.start());
    m2=fSpanDivPattern.matcher(contentPart);
    while (m2.find()) {
      if (m2.group(1).equals("/")) {
        --tagDepth;
      }
 else {
        ++tagDepth;
      }
      if (tagDepth < lastRelUnitnTagDepth) {
        lastRelUnitnTagDepth=100;
      }
    }
    lastMatch=m.end();
    try {
      doubleSize=Double.parseDouble(m.group(1));
      doubleSize=doubleSize * percentage / 100;
    }
 catch (    NumberFormatException e) {
      continue;
    }
    if (fRelativeCssUnits.contains(m.group(2))) {
      if (lastRelUnitnTagDepth < tagDepth) {
        m.appendReplacement(sb,m.group());
        continue;
      }
      lastRelUnitnTagDepth=tagDepth;
    }
    m.appendReplacement(sb,String.format(Locale.US,"font-size:%.2f%s;",doubleSize,m.group(2)));
  }
  m.appendTail(sb);
  return sb.toString();
}
