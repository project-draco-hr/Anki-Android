{
  super.onCreate(savedInstanceState);
  setContentView(R.layout.download_deck_picker);
  registerExternalStorageListener();
  initAlertDialogs();
  SharedPreferences pref=PrefSettings.getSharedPrefs(getBaseContext());
  username=pref.getString("username","");
  password=pref.getString("password","");
  serviceIntent=new Intent(SharedDeckPicker.this,DownloadManagerService.class);
  serviceIntent.putExtra("username",username);
  serviceIntent.putExtra("password",password);
  serviceIntent.putExtra("destination",pref.getString("deckPath",AnkiDroidApp.getStorageDirectory()));
  startService(serviceIntent);
  bindService(serviceIntent,mConnection,Context.BIND_AUTO_CREATE);
  mSharedDeckDownloads=new ArrayList<Download>();
  mSharedDecks=new ArrayList<SharedDeck>();
  mAllSharedDecks=new ArrayList<Object>();
  mSharedDecksAdapter=new SharedDecksAdapter();
  mSharedDecksListView=(ListView)findViewById(R.id.list);
  mSharedDecksListView.setAdapter(mSharedDecksAdapter);
  mSharedDecksListView.setOnItemClickListener(new OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      SharedPreferences preferences=PrefSettings.getSharedPrefs(getBaseContext());
      String deckPath=preferences.getString("deckPath",AnkiDroidApp.getStorageDirectory());
      deckToDownload=(SharedDeck)mAllSharedDecks.get(position);
      SharedDeckDownload sharedDeckDownload=new SharedDeckDownload(deckToDownload.getId(),deckToDownload.getTitle(),deckToDownload.getFileName(),deckToDownload.getSize());
      mSharedDeckDownloads.add(sharedDeckDownload);
      refreshSharedDecksList();
      try {
        startService(serviceIntent);
        mService.downloadFile(sharedDeckDownload);
      }
 catch (      RemoteException e) {
        e.printStackTrace();
      }
    }
  }
);
  Connection.getSharedDecks(getSharedDecksListener,new Connection.Payload(new Object[]{}));
}
