{
  final Collection col=((AnkiActivity)getActivity()).getCol();
  final JSONObject model=getModel();
switch (item.getItemId()) {
case R.id.action_add:
    Timber.i("CardTemplateEditor:: Add template button pressed");
  addNewTemplateWithCheck(getModel());
return true;
case R.id.action_delete:
{
Timber.i("CardTemplateEditor:: Delete template button pressed");
Resources res=getResources();
int position=getArguments().getInt("position");
try {
  JSONArray tmpls=model.getJSONArray("tmpls");
  final JSONObject template=tmpls.getJSONObject(position);
  if (tmpls.length() < 2) {
    Themes.showThemedToast(getActivity(),res.getString(R.string.card_template_editor_cant_delete),false);
    return true;
  }
  int numAffectedCards=col.getModels().tmplUseCount(model,position);
  confirmDeleteCards(template,model,numAffectedCards);
}
 catch (JSONException e) {
  throw new RuntimeException(e);
}
return true;
}
case R.id.action_preview:
{
Timber.i("CardTemplateEditor:: Preview model button pressed");
if (modelHasChanged()) {
col.getModels().save(model,true);
}
Intent i=new Intent(getActivity(),Previewer.class);
int pos=getArguments().getInt("position");
if (getArguments().getLong("noteId") != -1L && pos < col.getNote(getArguments().getLong("noteId")).cards().size()) {
long cid=col.getNote(getArguments().getLong("noteId")).cards().get(pos).getId();
i.putExtra("currentCardId",cid);
}
 else {
i.putExtra("modelId",getArguments().getLong("modelId"));
i.putExtra("cardOrd",pos);
}
((AnkiActivity)getActivity()).startActivityWithAnimation(i,ActivityTransitionAnimation.LEFT);
return true;
}
case R.id.action_confirm:
Timber.i("CardTemplateEditor:: Save model button pressed");
if (modelHasChanged()) {
col.getModels().save(model,true);
col.reset();
}
((AnkiActivity)getActivity()).finishWithAnimation(ActivityTransitionAnimation.RIGHT);
return true;
default :
return super.onOptionsItemSelected(item);
}
}
