import pycurl
import StringIO
import sys
CROWDIN_KEY = 'insert your Crowdin API key here'
PROJECT_IDENTIFIER = 'ankidroidv0-6'
path = '../res/values/'
sel = raw_input('update (m)aster file, update (t)ranslation or (r)efresh builds? ')
if (sel == 'm'):
    selu = raw_input('update (s)rings.xml or (a)rrays.xml? ')
    if (selu == 's'):
        filename = 'strings.xml'
    elif (selu == 'a'):
        filename = 'arrays.xml'
    else:
        filename = ''
        print 'nothing to do'
    if filename:
        print ('Update of Master File ' + filename)
        c = pycurl.Curl()
        fields = [((('files[' + filename) + ']'), (c.FORM_FILE, (path + filename)))]
        c.setopt(pycurl.URL, ((('http://crowdin.net/api/project/' + PROJECT_IDENTIFIER) + '/update-file?key=') + CROWDIN_KEY))
        c.setopt(pycurl.HTTPPOST, fields)
        b = StringIO.StringIO()
        c.setopt(pycurl.WRITEFUNCTION, b.write)
        c.perform()
        c.close()
        print b.getvalue()
elif (sel == 't'):
    print 'still problems with crowding here'
    language = raw_input('enter language code: ')
    selu = raw_input('update (s)rings.xml or (a)rrays.xml? ')
    path = (('../res/values-' + language) + '/')
    if (selu == 's'):
        filename = 'strings.xml'
    elif (selu == 'a'):
        filename = 'arrays.xml'
    else:
        filename = ''
        print 'nothing to do'
    print ((('Update of Translation ' + language) + ' for ') + filename)
    if filename:
        if language:
            c = pycurl.Curl()
            fields = [((('files[' + filename) + ']'), (c.FORM_FILE, (path + filename))), ('language', language), ('auto_approve_imported', '0')]
            c.setopt(pycurl.URL, ((('http://crowdin.net/api/project/' + PROJECT_IDENTIFIER) + '/upload-translation?key=') + CROWDIN_KEY))
            c.setopt(pycurl.HTTPPOST, fields)
            b = StringIO.StringIO()
            c.setopt(pycurl.WRITEFUNCTION, b.write)
            c.perform()
            c.close()
            print b.getvalue()
        else:
            print 'no language code entered'
elif (sel == 'r'):
    print 'Force translation export'
    c = pycurl.Curl()
    c.setopt(pycurl.URL, ((('http://crowdin.net/api/project/' + PROJECT_IDENTIFIER) + '/export?&key=') + CROWDIN_KEY))
    b = StringIO.StringIO()
    c.setopt(pycurl.WRITEFUNCTION, b.write)
    c.perform()
    c.close()
    print b.getvalue()
else:
    print 'nothing to do'
