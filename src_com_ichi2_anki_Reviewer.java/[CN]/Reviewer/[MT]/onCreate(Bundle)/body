{
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  Log.i(AnkiDroidApp.TAG,"Reviewer - onCreate");
  mChangeBorderStyle=Themes.getTheme() == Themes.THEME_ANDROID_LIGHT || Themes.getTheme() == Themes.THEME_ANDROID_DARK;
  setVolumeControlStream(AudioManager.STREAM_MUSIC);
  Deck deck=DeckManager.getMainDeck();
  if (deck == null) {
    finishNoStorageAvailable();
    return;
  }
 else {
    mMediaDir=setupMedia(deck);
    restorePreferences();
    deck.resetUndo();
    if (mPrefFullscreenReview) {
      getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);
      if (Integer.valueOf(android.os.Build.VERSION.SDK) < 11) {
        requestWindowFeature(Window.FEATURE_NO_TITLE);
      }
    }
    requestWindowFeature(Window.FEATURE_INDETERMINATE_PROGRESS);
    registerExternalStorageListener();
    if (mNightMode) {
      mCurrentBackgroundColor=Themes.getNightModeCardBackground(this);
    }
 else {
      mCurrentBackgroundColor=Color.WHITE;
    }
    mRefreshWebview=getRefreshWebviewAndInitializeWebviewVariables();
    initLayout(R.layout.flashcard);
    if (mPrefTextSelection) {
      clipboardSetText("");
      Lookup.initialize(this,mDeckFilename);
    }
    try {
      mCardTemplate=Utils.convertStreamToString(getAssets().open("card_template.html"));
      mCardTemplate=mCardTemplate.replaceFirst("var availableWidth = \\d*;","var availableWidth = " + getAvailableWidthInCard() + ";");
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
    long timelimit=deck.getSessionTimeLimit() * 1000;
    Log.i(AnkiDroidApp.TAG,"SessionTimeLimit: " + timelimit + " ms.");
    mSessionTimeLimit=System.currentTimeMillis() + timelimit;
    mSessionCurrReps=0;
    if (mSpeakText && Integer.valueOf(android.os.Build.VERSION.SDK) > 3) {
      ReadText.initializeTts(this,mDeckFilename);
    }
    if (mPrefWhiteboard && MetaDB.getWhiteboardState(this,mDeckFilename) == 1) {
      mShowWhiteboard=true;
      mWhiteboard.setVisibility(View.VISIBLE);
    }
    DeckTask.launchDeckTask(DeckTask.TASK_TYPE_ANSWER_CARD,mAnswerCardHandler,new DeckTask.TaskData(0,deck,null));
  }
}
