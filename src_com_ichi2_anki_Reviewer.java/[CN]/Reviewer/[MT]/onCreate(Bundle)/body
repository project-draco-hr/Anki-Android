{
  mExtensions=new ReviewerExtRegistry(getBaseContext());
  Themes.applyTheme(this);
  super.onCreate(savedInstanceState);
  if (mPrefFullscreenReview) {
    getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);
    if (AnkiDroidApp.SDK_VERSION <= 11) {
      requestWindowFeature(Window.FEATURE_NO_TITLE);
    }
  }
  mChangeBorderStyle=Themes.getTheme() == Themes.THEME_ANDROID_LIGHT || Themes.getTheme() == Themes.THEME_ANDROID_DARK;
  setVolumeControlStream(AudioManager.STREAM_MUSIC);
  Collection col=AnkiDroidApp.getCol();
  if (col == null) {
    reloadCollection(savedInstanceState);
    return;
  }
 else {
    mSched=col.getSched();
    mCollectionFilename=col.getPath();
    mBaseUrl=Utils.getBaseUrl(col.getMedia().getDir());
    restorePreferences();
    setFullScreen(mPrefFullscreenReview);
    registerExternalStorageListener();
    if (mNightMode) {
      mCurrentBackgroundColor=Themes.getNightModeCardBackground(this);
    }
 else {
      mCurrentBackgroundColor=Color.WHITE;
    }
    mUseQuickUpdate=shouldUseQuickUpdate();
    initLayout(R.layout.flashcard);
    try {
      String[] title=mSched.getCol().getDecks().current().getString("name").split("::");
      AnkiDroidApp.getCompat().setTitle(this,title[title.length - 1],mInvertedColors);
    }
 catch (    JSONException e) {
      throw new RuntimeException(e);
    }
    AnkiDroidApp.getCompat().setSubtitle(this,"",mInvertedColors);
    if (mPrefTextSelection) {
      clipboardSetText("");
    }
    try {
      mCardTemplate=Utils.convertStreamToString(getAssets().open("card_template.html"));
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
    if (mSpeakText) {
      ReadText.initializeTts(this);
      mTTSProgressDialog=new ProgressDialog(this);
      new AsyncTask<String,Void,Void>(){
        @Override protected void onPreExecute(){
          mTTSProgressDialog.setMessage("Init TTS");
          mTTSProgressDialog.show();
        }
        @Override protected Void doInBackground(        String... params){
          while (ReadText.mTTSInitDone == false) {
            try {
              Thread.sleep(500);
            }
 catch (            InterruptedException e) {
              e.printStackTrace();
            }
          }
          return null;
        }
        @Override protected void onPostExecute(        Void res){
          mTTSProgressDialog.dismiss();
          DeckTask.launchDeckTask(DeckTask.TASK_TYPE_ANSWER_CARD,mAnswerCardHandler,new DeckTask.TaskData(mSched,null,0));
        }
      }
.execute();
    }
    if (mPrefWhiteboard && mCurrentCard != null && MetaDB.getWhiteboardState(this,mCurrentCard.getDid()) == 1) {
      mShowWhiteboard=true;
      mWhiteboard.setVisibility(View.VISIBLE);
    }
    DeckTask.launchDeckTask(DeckTask.TASK_TYPE_ANSWER_CARD,mAnswerCardHandler,new DeckTask.TaskData(mSched,null,0));
    mSched.setReps(mSched.getReps() - 1);
  }
}
