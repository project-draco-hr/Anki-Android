{
  Log.i(AnkiDroidApp.TAG,"updateCard");
  String baseUrl="";
  Boolean isJapaneseModel=false;
  content=recalculateHardCodedFontSize(content,mDisplayFontSize);
  Model myModel=null;
  if (mCurrentCard != null) {
    final String japaneseModelTag="Japanese";
    Deck currentDeck=AnkiDroidApp.deck();
    myModel=Model.getModel(currentDeck,mCurrentCard.getCardModelId(),false);
    baseUrl=Utils.getBaseUrl(mMediaDir,myModel,currentDeck);
    content=myModel.getCSSForFontColorSize(mCurrentCard.getCardModelId(),mDisplayFontSize,mInvertedColors) + Model.invertColors(content,mInvertedColors);
    isJapaneseModel=myModel.hasTag(japaneseModelTag);
    mMainLayout.setBackgroundColor(Color.parseColor(myModel.getBackgroundColor(mCurrentCard.getCardModelId(),mInvertedColors)));
  }
 else {
    mCard.getSettings().setDefaultFontSize(calculateDynamicFontSize(content));
    baseUrl=Utils.urlEncodeMediaDir(mDeckFilename.replace(".anki",".media/"));
  }
  int questionStartsAt=content.indexOf("<a name=\"question\"></a><hr/>");
  String question="";
  String answer="";
  if (isQuestionDisplayed()) {
    if (sDisplayAnswer && (questionStartsAt != -1)) {
      question=Sound.parseSounds(baseUrl,content.substring(0,questionStartsAt),mSpeakText,MetaDB.LANGUAGE_QUESTION);
      answer=Sound.parseSounds(baseUrl,content.substring(questionStartsAt,content.length()),mSpeakText,MetaDB.LANGUAGE_ANSWER);
    }
 else {
      question=Sound.parseSounds(baseUrl,content.substring(0,content.length() - 5),mSpeakText,MetaDB.LANGUAGE_QUESTION) + "<hr/>";
    }
  }
 else {
    int qa=MetaDB.LANGUAGE_QUESTION;
    if (sDisplayAnswer) {
      qa=MetaDB.LANGUAGE_ANSWER;
    }
    answer=Sound.parseSounds(baseUrl,content,mSpeakText,qa);
  }
  question=LaTeX.parseLaTeX(AnkiDroidApp.deck(),question);
  answer=LaTeX.parseLaTeX(AnkiDroidApp.deck(),answer);
  if (mPrefUseRubySupport && isJapaneseModel) {
    content=RubyParser.ankiStripKanji(question) + RubyParser.ankiRubyToMarkup(answer);
  }
 else {
    content=question + answer;
  }
  content=content.replace("font-weight:600;","font-weight:700;");
  if (isHebrewFixEnabled()) {
    content=applyFixForHebrew(content);
  }
  Log.i(AnkiDroidApp.TAG,"content card = \n" + content);
  StringBuilder style=new StringBuilder();
  style.append(getCustomFontsStyle());
  style.append(getDefaultFontStyle());
  style.append(getDeckStyle(mCurrentCard.mDeck.getDeckPath()));
  Log.i(AnkiDroidApp.TAG,"::style::" + style);
  String card=mCardTemplate.replace("::content::",content).replace("::style::",style.toString());
  Log.i(AnkiDroidApp.TAG,"base url = " + baseUrl);
  if (mCustomFontFiles.length != 0) {
    if (myModel != null) {
      mNextCard.setBackgroundColor(Color.parseColor(myModel.getBackgroundColor(mCurrentCard.getCardModelId(),mInvertedColors)));
    }
    mNextCard.loadDataWithBaseURL(baseUrl,card,"text/html","utf-8",null);
    mNextCard.setVisibility(View.VISIBLE);
    mCardFrame.removeView(mCard);
    mCard.destroy();
    mCard=mNextCard;
    mNextCard=createWebView();
    mNextCard.setVisibility(View.GONE);
    mCardFrame.addView(mNextCard);
  }
 else {
    mCard.loadDataWithBaseURL(baseUrl,card,"text/html","utf-8",null);
  }
  if (!mConfigurationChanged && mPlaySoundsAtStart) {
    if (!mSpeakText) {
      Sound.playSounds(null,0);
    }
 else     if (!sDisplayAnswer) {
      Sound.playSounds(Utils.stripHTML(mCurrentCard.getQuestion()),MetaDB.LANGUAGE_QUESTION);
    }
 else {
      Sound.playSounds(Utils.stripHTML(mCurrentCard.getAnswer()),MetaDB.LANGUAGE_ANSWER);
    }
  }
}
