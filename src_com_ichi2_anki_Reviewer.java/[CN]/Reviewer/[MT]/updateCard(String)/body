{
  Log.i(AnkiDroidApp.TAG,"updateCard");
  Lookup.initialize(this,mCurrentCard.getDid());
  if (mCurrentSimpleInterface) {
    fillFlashcard(mShowAnimations);
  }
 else {
    content=recalculateHardCodedFontSize(content,mDisplayFontSize);
    if (mCurrentCard == null) {
      mCard.getSettings().setDefaultFontSize(calculateDynamicFontSize(content));
    }
    String question="";
    String answer="";
    int qa=-1;
    if (sDisplayAnswer) {
      qa=MetaDB.LANGUAGES_QA_ANSWER;
      answer=mCurrentCard.getPureAnswerForReading();
      if (!mAnswerSoundsAdded) {
        Sound.addSounds(mBaseUrl,answer,qa);
        mAnswerSoundsAdded=true;
      }
    }
 else {
      Sound.resetSounds();
      mAnswerSoundsAdded=false;
      qa=MetaDB.LANGUAGES_QA_QUESTION;
      question=mCurrentCard.getQuestion(mCurrentSimpleInterface);
      Sound.addSounds(mBaseUrl,question,qa);
    }
    content=Sound.expandSounds(mBaseUrl,content,mSpeakText,qa);
    content=content.replace("font-weight:600;","font-weight:700;");
    String cardClass="card card" + (mCurrentCard.getOrd() + 1);
    if (mPrefCenterVertically) {
      cardClass+=" vertically_centered";
    }
    Log.i(AnkiDroidApp.TAG,"content card = \n" + content);
    StringBuilder style=new StringBuilder();
    mExtensions.updateCssStyle(style);
    if (mRelativeImageSize != 100) {
      style.append(String.format("img { zoom: %s }\n",mRelativeImageSize / 100.0));
    }
    Log.i(AnkiDroidApp.TAG,"::style::" + style);
    if (mNightMode) {
      content=HtmlColors.invertColors(content);
      cardClass+=" night_mode";
    }
    content=SmpToHtmlEntity(content);
    mCardContent=new SpannedString(mCardTemplate.replace("::content::",content).replace("::style::",style.toString()).replace("::class::",cardClass));
    Log.i(AnkiDroidApp.TAG,"base url = " + mBaseUrl);
    if (SAVE_CARD_CONTENT) {
      try {
        FileOutputStream f=new FileOutputStream(new File(AnkiDroidApp.getCurrentAnkiDroidDirectory(),"card.html"));
        try {
          f.write(mCardContent.toString().getBytes());
        }
  finally {
          f.close();
        }
      }
 catch (      IOException e) {
        Log.d(AnkiDroidApp.TAG,"failed to save card",e);
      }
    }
    fillFlashcard(mShowAnimations);
  }
  if (!mConfigurationChanged) {
    playSounds(false);
  }
}
