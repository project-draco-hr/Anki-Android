{
  String mdir=getDir();
  String base=new File(opath).getName().replaceAll("[][<>:/\\&]","");
  String dst=mdir + base;
  File newMediaFile=new File(dst);
  if (!newMediaFile.exists()) {
    try {
      Utils.copyFile(new File(opath),newMediaFile);
    }
 catch (    IOException e) {
      Log.e(AnkiDroidApp.TAG,"Could not copy file " + opath + " to location "+ dst,e);
    }
    return base;
  }
  if (filesIdentical(opath,dst)) {
    return base;
  }
  String root, ext;
  int extIndex=base.lastIndexOf('.');
  if (extIndex == 0 || extIndex == -1) {
    root=base;
    ext="";
  }
 else {
    root=base.substring(0,extIndex);
    ext=base.substring(extIndex);
  }
  int num=1;
  StringBuilder sb=new StringBuilder(mdir);
  sb.append("/").append(root).append(" (");
  do {
    StringBuilder sb2=new StringBuilder(sb);
    sb2.append(num).append(ext);
    newMediaFile=new File(sb2.toString());
    num+=1;
  }
 while (newMediaFile.exists());
  try {
    Utils.copyFile(new File(opath),newMediaFile);
  }
 catch (  IOException e) {
    Log.e(AnkiDroidApp.TAG,"Could not copy file " + opath + " to location "+ newMediaFile.getAbsolutePath(),e);
  }
  return newMediaFile.getName();
}
