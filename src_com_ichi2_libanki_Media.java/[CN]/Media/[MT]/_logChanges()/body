{
  Pair<List<String>,List<String>> result=_changes();
  ArrayList<Object[]> log=new ArrayList<Object[]>();
  ArrayList<Object[]> media=new ArrayList<Object[]>();
  ArrayList<Object[]> mediaRem=new ArrayList<Object[]>();
  for (  String f : result.first) {
    long mt=_mtime(f);
    String csum=_checksum(getDir().concat(File.separator).concat(f));
    media.add(new Object[]{f,csum,mt});
    log.add(new Object[]{f,MEDIA_ADD});
  }
  for (  String f : result.second) {
    mediaRem.add(new Object[]{f});
    log.add(new Object[]{f,MEDIA_REM});
  }
  mMediaDb.executeMany("insert or replace into media values (?, ?, ?)",media);
  if (mediaRem.size() > 0) {
    mMediaDb.executeMany("delete from media where fname = ?",mediaRem);
  }
  mMediaDb.execute("update meta set dirMod = ?",new Object[]{_mtime(getDir())});
  mMediaDb.executeMany("insert or replace into log values (?, ?)",log);
}
