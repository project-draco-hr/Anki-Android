{
  calcStats(type);
  int height=mImageView.getMeasuredHeight();
  int width=mImageView.getMeasuredWidth();
  if (height <= 0 || width <= 0) {
    return null;
  }
  BufferedImage bufferedFrameImage=new BufferedImage(width,height,BufferedImage.TYPE_INT_ARGB);
  Graphics2D g=bufferedFrameImage.createGraphics();
  Rectangle rect=new Rectangle(width,height);
  g.setClip(rect);
  g.setColor(Color.BLACK);
  float textSize=AnkiStatsTaskHandler.getInstance().getmStandardTextSize() * 0.75f;
  g.setFontSize(textSize);
  float FontHeigth=g.getFontMetrics().getHeight(true);
  mFrameThickness=Math.round(FontHeigth * 4.0f);
  PlotSheet plotSheet=new PlotSheet(mSeriesList[0][0] - 0.5,mSeriesList[0][mSeriesList[0].length - 1] + 0.5,0,mPeak * 1.03);
  plotSheet.setFrameThickness(mFrameThickness);
  double xTics=ticsCalcX(targetPixelDistanceBetweenTics,rect);
  double yTics=ticsCalcY(targetPixelDistanceBetweenTics,rect);
  XAxis xaxis=new XAxis(plotSheet,0,xTics,xTics / 2.0);
  YAxis yaxis=new YAxis(plotSheet,0,yTics,yTics / 2.0);
  double[] timePositions={0,6,12,18,23};
  xaxis.setExplicitTics(timePositions,mImageView.getResources().getStringArray(R.array.stats_day_time_strings));
  xaxis.setOnFrame();
  xaxis.setName(mImageView.getResources().getString(mAxisTitles[0]));
  xaxis.setIntegerNumbering(true);
  yaxis.setIntegerNumbering(true);
  yaxis.setName(mImageView.getResources().getString(mAxisTitles[1]));
  yaxis.setOnFrame();
  PlotSheet hiddenPlotSheet=new PlotSheet(mSeriesList[0][0] - 0.5,mSeriesList[0][mSeriesList[0].length - 1] + 0.5,0,mMcount * 1.03);
  hiddenPlotSheet.setFrameThickness(mFrameThickness);
  BarGraph[] barGraphs=new BarGraph[2];
  for (int i=1; i < 3; i++) {
    double[][] bars=new double[2][];
    bars[0]=mSeriesList[0];
    bars[1]=mSeriesList[i];
    PlotSheet usedPlotSheet=(i == 2) ? hiddenPlotSheet : plotSheet;
    double barThickness=(i == 1) ? mBarThickness : 0.2;
    barGraphs[i - 1]=new BarGraph(usedPlotSheet,barThickness,bars,new Color(mImageView.getResources().getColor(mColors[i - 1])));
    barGraphs[i - 1].setFilling(true);
    barGraphs[i - 1].setName(mImageView.getResources().getString(mValueLabels[i - 1]));
    barGraphs[i - 1].setFillColor(new Color(mImageView.getResources().getColor(mColors[i - 1])));
  }
  double rightYtics=ticsCalc(targetPixelDistanceBetweenTics,rect,mMcount);
  YAxis rightYaxis=new YAxis(hiddenPlotSheet,0,rightYtics,rightYtics / 2.0);
  rightYaxis.setIntegerNumbering(true);
  rightYaxis.setName(mImageView.getResources().getString(mAxisTitles[2]));
  rightYaxis.setOnRightSideFrame();
  int red=Color.LIGHT_GRAY.getRed();
  int green=Color.LIGHT_GRAY.getGreen();
  int blue=Color.LIGHT_GRAY.getBlue();
  Color newGridColor=new Color(red,green,blue,222);
  XGrid xGrid=new XGrid(plotSheet,0,targetPixelDistanceBetweenTics);
  YGrid yGrid=new YGrid(plotSheet,0,targetPixelDistanceBetweenTics);
  xGrid.setColor(newGridColor);
  yGrid.setColor(newGridColor);
  yGrid.setExplicitTics(timePositions);
  plotSheet.setFontSize(textSize);
  for (  BarGraph barGraph : barGraphs) {
    plotSheet.addDrawable(barGraph);
  }
  plotSheet.addDrawable(xaxis);
  plotSheet.addDrawable(yaxis);
  plotSheet.addDrawable(rightYaxis);
  plotSheet.addDrawable(xGrid);
  plotSheet.addDrawable(yGrid);
  plotSheet.paint(g);
  Bitmap bitmap=bufferedFrameImage.getBitmap();
  bitmap.prepareToDraw();
  return bitmap;
}
