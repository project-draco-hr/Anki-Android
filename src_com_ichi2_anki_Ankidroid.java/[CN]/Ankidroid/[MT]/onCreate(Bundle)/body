{
  super.onCreate(savedInstanceState);
  Bundle extras=getIntent().getExtras();
  initResourceValues();
  Log.i("ankidroidstart","savedInstanceState: " + savedInstanceState);
  SharedPreferences preferences=PreferenceManager.getDefaultSharedPreferences(getBaseContext());
  corporalPunishments=preferences.getBoolean("corporalPunishments",false);
  timerAndWhiteboard=preferences.getBoolean("timerAndWhiteboard",true);
  spacedRepetition=preferences.getBoolean("spacedRepetition",true);
  deckPath=preferences.getString("deckPath","/sdcard");
  if (extras != null && extras.getString(OPT_DB) != null) {
    deckFilename=extras.getString(OPT_DB);
    Log.i("ankidroidstart","deckFilename from extras: " + deckFilename);
  }
 else   if (savedInstanceState != null) {
    deckFilename=savedInstanceState.getString("deckFilename");
    Log.i("ankidroidstart","deckFilename from savedInstanceState: " + deckFilename);
  }
 else {
    Log.i("ankidroidstart",preferences.getAll().toString());
    deckFilename=preferences.getString("deckFilename",null);
    Log.i("ankidroidstart","deckFilename from preferences: " + deckFilename);
  }
  if (deckFilename == null || !new File(deckFilename).exists()) {
    boolean generateSampleDeck=preferences.getBoolean("generateSampleDeck",true);
    if (generateSampleDeck) {
      String SAMPLE_DECK_FILENAME="/sdcard/country-capitals.anki";
      if (!new File("/sdcard","country-capitals.anki").exists()) {
        try {
          InputStream stream=getResources().getAssets().open("country-capitals.anki");
          boolean written=writeToFile(stream,SAMPLE_DECK_FILENAME);
          if (!written) {
            openDeckPicker();
            return;
          }
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
      }
      initLayout(R.layout.flashcard_portrait);
      loadDeck(SAMPLE_DECK_FILENAME);
    }
 else {
      openDeckPicker();
    }
  }
 else {
    initLayout(R.layout.flashcard_portrait);
    loadDeck(deckFilename);
  }
}
