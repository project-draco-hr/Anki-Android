{
  Matcher m=sTypeAnsPat.matcher(buf);
  DiffEngine diff=new DiffEngine();
  StringBuilder sb=new StringBuilder();
  boolean theSame=userAnswer.equals(correctAnswer);
  sb.append("<div");
  if (!mPrefWriteAnswers) {
    sb.append(" class=\"typeOff\"");
  }
  sb.append("><code id=typeans>");
  if (!theSame && !TextUtils.isEmpty(userAnswer)) {
    sb.append(diff.diff_prettyHtml(diff.diff_main(userAnswer,correctAnswer),mNightMode));
    sb.append("<br>&darr;<br>");
  }
  if (mPrefWriteAnswers) {
    sb.append(diff.diff_prettyHtml(diff.diff_main(correctAnswer,correctAnswer),mNightMode));
    if (theSame) {
      sb.append("\u2714");
    }
  }
 else {
    sb.append(correctAnswer);
  }
  sb.append("</code></div>");
  return m.replaceFirst(sb.toString());
}
