{
  mSched=col.getSched();
  mCollectionFilename=col.getPath();
  mBaseUrl=Utils.getBaseUrl(col.getMedia().dir());
  restorePreferences();
  if (mPrefFullscreenReview) {
    UIUtils.setFullScreen(this);
  }
  registerExternalStorageListener();
  if (mNightMode) {
    mCurrentBackgroundColor=Themes.getNightModeCardBackground(this);
  }
 else {
    mCurrentBackgroundColor=Color.WHITE;
  }
  mUseQuickUpdate=shouldUseQuickUpdate();
  initLayout();
  setTitle();
  if (!mDisableClipboard) {
    clipboardSetText("");
  }
  try {
    mCardTemplate=Utils.convertStreamToString(getAssets().open("card_template.html"));
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  if (mSpeakText) {
    ReadText.initializeTts(this);
  }
  long deckID=mSched.getCol().getDecks().current().optLong("id",-1);
  if (mPrefWhiteboard && deckID != -1 && MetaDB.getWhiteboardState(this,deckID) == 1) {
    mShowWhiteboard=true;
    mWhiteboard.setVisibility(View.VISIBLE);
  }
  Lookup.initialize(this);
}
