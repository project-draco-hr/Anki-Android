{
  Download download=downloads[0];
  URL url;
  RandomAccessFile file=null;
  InflaterInputStream iis=null;
  try {
    url=new URL(Collection.SYNC_URL + "fulldown");
    HttpURLConnection connection=(HttpURLConnection)url.openConnection();
    connection.setDoInput(true);
    connection.setDoOutput(true);
    connection.setUseCaches(false);
    connection.setRequestMethod("POST");
    connection.setRequestProperty("Content-type","application/x-www-form-urlencoded");
    connection.connect();
    long startTime=System.currentTimeMillis();
    DataOutputStream ds=new DataOutputStream(connection.getOutputStream());
    String data="p=" + URLEncoder.encode(mPassword,"UTF-8") + "&u="+ URLEncoder.encode(mUsername,"UTF-8")+ "&d="+ URLEncoder.encode(download.getTitle(),"UTF-8");
    ds.writeBytes(data);
    ds.flush();
    ds.close();
    if (connection.getResponseCode() / 100 != 2) {
      download.setStatus(Download.STATUS_ERROR);
      publishProgress();
    }
 else {
      download.setStatus(Download.STATUS_DOWNLOADING);
      publishProgress();
    }
    int contentLength=connection.getContentLength();
    if (contentLength < 1) {
    }
    if (download.getSize() == -1 && contentLength != -1) {
      download.setSize(contentLength);
    }
    file=new RandomAccessFile(mDestination + "/tmp/" + download.getFilename()+ ".anki.tmp","rw");
    iis=new InflaterInputStream(connection.getInputStream());
    int phase=0;
    while (download.getStatus() == Download.STATUS_DOWNLOADING) {
      byte[] buffer;
      buffer=new byte[MAX_BUFFER_SIZE];
      int read=iis.read(buffer);
      if (read == -1) {
        break;
      }
      file.write(buffer,0,read);
      download.setDownloaded(download.getDownloaded() + read);
      phase++;
      if (phase == 249) {
        phase=0;
        publishProgress();
      }
    }
    if (download.getStatus() == Download.STATUS_DOWNLOADING) {
      download.setStatus(Download.STATUS_COMPLETE);
      new File(mDestination + "/tmp/" + download.getFilename()+ ".anki.tmp").renameTo(new File(mDestination + "/" + download.getFilename()+ ".anki"));
      long finishTime=System.currentTimeMillis();
    }
 else     if (download.getStatus() == Download.STATUS_CANCELLED) {
      new File(mDestination + "/tmp/" + download.getFilename()+ ".anki.tmp").delete();
    }
    publishProgress();
    connection.disconnect();
  }
 catch (  Exception e) {
    e.printStackTrace();
    download.setStatus(Download.STATUS_ERROR);
    publishProgress();
  }
 finally {
    if (file != null) {
      try {
        file.close();
      }
 catch (      Exception e) {
      }
    }
    if (iis != null) {
      try {
        iis.close();
      }
 catch (      Exception e) {
      }
    }
  }
  return download;
}
