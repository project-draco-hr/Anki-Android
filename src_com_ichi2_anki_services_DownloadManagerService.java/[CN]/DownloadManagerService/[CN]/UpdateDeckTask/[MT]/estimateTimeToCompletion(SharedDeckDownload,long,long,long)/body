{
  double avgBatchTime=0.0;
  avgBatchTime=0;
  recentBatchTimings[((int)runningAvgCount) % runningAvgLength]=lastBatchTime;
  elapsedTime+=lastBatchTime;
  int usedForAvg=Math.min(((int)runningAvgCount) + 1,runningAvgLength);
  for (int i=0; i < usedForAvg; i++) {
    avgBatchTime+=recentBatchTimings[i];
  }
  avgBatchTime/=usedForAvg;
  download.setEstTimeToCompletion(Math.max(0,totalBatches - currentBatch - 1) * avgBatchTime / 1000.0);
}
