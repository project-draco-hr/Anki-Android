{
  double avgBatchTime=0.0;
  avgBatchTime=0;
  recentBatchTimings[((int)currentBatch) % runningAverageLength]=lastBatchTime;
  elapsedTime+=lastBatchTime;
  int usedForAvg=Math.min(((int)currentBatch) + 1,runningAverageLength);
  for (int i=0; i < usedForAvg; i++) {
    avgBatchTime+=recentBatchTimings[i];
  }
  avgBatchTime/=usedForAvg;
  download.setEstTimeToCompletion(Math.max(0,totalBatches - currentBatch - 1) * avgBatchTime / 1000.0);
  Log.w(TAG,"tot: " + totalBatches + " "+ currentBatch+ " "+ lastBatchTime+ " "+ avgBatchTime+ " Elapsed = "+ elapsedTime / 1000.0 + " sec, total estimated = " + (elapsedTime + Math.max(0,totalBatches - currentBatch) * avgBatchTime) / 1000.0 + " sec.");
}
