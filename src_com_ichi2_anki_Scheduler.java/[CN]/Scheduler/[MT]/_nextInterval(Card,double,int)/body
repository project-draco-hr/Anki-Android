{
  double interval=card.getInterval();
  double factor=card.getFactor();
  if (delay < 0) {
    interval=Math.max(card.getLastInterval(),card.getInterval() + delay);
    if (interval < mMidIntervalMin) {
      interval=0;
    }
    delay=0;
  }
  if (ease == Card.EASE_FAILED) {
    interval*=mDelay2;
    if (interval < mHardIntervalMin) {
      interval=0;
    }
  }
 else   if (interval == 0) {
    if (ease == Card.EASE_HARD) {
      interval=mHardIntervalMin + card.getFuzz() * (mHardIntervalMax - mHardIntervalMin);
    }
 else     if (ease == Card.EASE_MID) {
      interval=mMidIntervalMin + card.getFuzz() * (mMidIntervalMax - mMidIntervalMin);
    }
 else     if (ease == Card.EASE_EASY) {
      interval=mEasyIntervalMin + card.getFuzz() * (mEasyIntervalMax - mEasyIntervalMin);
    }
  }
 else {
    if ((interval < mHardIntervalMax) && (interval > 0.166)) {
      double mid=(mMidIntervalMin + mMidIntervalMax) / 2.0;
      interval=mid / factor;
    }
    if (ease == Card.EASE_HARD) {
      interval=(interval + delay / 4.0) * 1.2;
    }
 else     if (ease == Card.EASE_MID) {
      interval=(interval + delay / 2.0) * factor;
    }
 else     if (ease == Card.EASE_EASY) {
      interval=(interval + delay) * factor * FACTOR_FOUR;
    }
    interval*=0.95 + card.getFuzz() * (1.05 - 0.95);
  }
  return interval;
}
