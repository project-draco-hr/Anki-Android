{
  Log.i(AnkiDroidApp.TAG,"NotificationService: OnStart");
  Context context=AnkiDroidApp.getInstance().getBaseContext();
  SharedPreferences preferences=AnkiDroidApp.getSharedPrefs(context);
  int minimumCardsDueForNotification=Integer.parseInt(preferences.getString("minimumCardsDueForNotification","25"));
  int dueCardsCount=WidgetStatus.fetchDue(context);
  if (dueCardsCount >= minimumCardsDueForNotification) {
    int icon=R.drawable.anki;
    CharSequence tickerText=String.format(getString(R.string.widget_minimum_cards_due_notification_ticker_text),dueCardsCount);
    long when=System.currentTimeMillis();
    Notification notification=new Notification(icon,tickerText,when);
    if (preferences.getBoolean("widgetVibrate",false)) {
      notification.defaults|=Notification.DEFAULT_VIBRATE;
    }
    if (preferences.getBoolean("widgetBlink",false)) {
      notification.defaults|=Notification.DEFAULT_LIGHTS;
    }
    Context appContext=getApplicationContext();
    CharSequence contentTitle=getText(R.string.widget_minimum_cards_due_notification_ticker_title);
    Intent ankiDroidIntent=new Intent(context,DeckPicker.class);
    ankiDroidIntent.setAction(Intent.ACTION_MAIN);
    ankiDroidIntent.addCategory(Intent.CATEGORY_LAUNCHER);
    PendingIntent pendingAnkiDroidIntent=PendingIntent.getActivity(context,0,ankiDroidIntent,PendingIntent.FLAG_UPDATE_CURRENT);
    notification.setLatestEventInfo(appContext,contentTitle,tickerText,pendingAnkiDroidIntent);
    mNotificationManager.notify(WIDGET_NOTIFY_ID,notification);
  }
 else {
    mNotificationManager.cancel(WIDGET_NOTIFY_ID);
  }
}
