{
  Deck deck=params[0].getDeck();
  Card newCard;
  Card oldCard=params[0].getCard();
  long currentCardId=0;
  if (oldCard != null) {
    currentCardId=params[0].getCard().getId();
  }
  AnkiDb ankiDB=AnkiDatabaseManager.getDatabase(deck.getDeckPath());
  ankiDB.getDatabase().beginTransaction();
  try {
    long oldCardId=deck.undo(currentCardId);
    newCard=deck.getCard();
    if (oldCardId != 0) {
      newCard=deck.cardFromId(oldCardId);
    }
    publishProgress(new TaskData(newCard));
    ankiDB.getDatabase().setTransactionSuccessful();
  }
  finally {
    ankiDB.getDatabase().endTransaction();
  }
  return null;
}
