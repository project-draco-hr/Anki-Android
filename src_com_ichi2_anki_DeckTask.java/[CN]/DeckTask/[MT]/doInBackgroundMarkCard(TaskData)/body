{
  Deck deck=params[0].getDeck();
  Card currentCard=params[0].getCard();
  AnkiDb ankiDB=AnkiDatabaseManager.getDatabase(deck.getDeckPath());
  ankiDB.getDatabase().beginTransaction();
  try {
    if (currentCard != null) {
      if (currentCard.hasTag(Deck.TAG_MARKED)) {
        deck.deleteTag(currentCard.getFactId(),Deck.TAG_MARKED);
      }
 else {
        deck.addTag(currentCard.getFactId(),Deck.TAG_MARKED);
      }
    }
    publishProgress(new TaskData(currentCard));
    ankiDB.getDatabase().setTransactionSuccessful();
  }
  finally {
    ankiDB.getDatabase().endTransaction();
  }
  return null;
}
